<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>statspy.core &mdash; StatsPy 0.1.0a1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.0a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="StatsPy 0.1.0a1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../index.html">StatsPy 0.1.0a1 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for statspy.core</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;module core.py</span>

<span class="sd">This module contains the base classes to define a random variable,</span>
<span class="sd">a probability function, or a parameter.</span>
<span class="sd">The module is also hosting global dictonaries used to keep track of</span>
<span class="sd">the different variables, parameters and probability functions declared.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Param&#39;</span><span class="p">,</span><span class="s">&#39;PF&#39;</span><span class="p">,</span><span class="s">&#39;RV&#39;</span><span class="p">,</span><span class="s">&#39;logger&#39;</span><span class="p">,</span><span class="s">&#39;get_obj&#39;</span><span class="p">]</span>

<span class="n">_dparams</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c"># Dictionary hosting the list of parameters</span>
<span class="n">_dpfs</span>    <span class="o">=</span> <span class="p">{}</span>  <span class="c"># Dictionary hosting the list of probability functions</span>
<span class="n">_drvs</span>    <span class="o">=</span> <span class="p">{}</span>  <span class="c"># Dictionary hosting the list of random variables</span>

<span class="c"># Logging system</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">_ch</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span> <span class="c"># Console handler</span>
<span class="n">_formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%(asctime)s</span><span class="s"> - </span><span class="si">%(name)s</span><span class="s"> - </span><span class="si">%(levelname)s</span><span class="s"> - </span><span class="si">%(message)s</span><span class="s">&#39;</span><span class="p">)</span>
<span class="n">_ch</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">_formatter</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">_ch</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;logger has been set to DEBUG mode&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Param"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param">[docs]</a><span class="k">class</span> <span class="nc">Param</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class to define a PF shape parameter. </span>

<span class="sd">       Two types of parameters can be built:</span>

<span class="sd">       * RAW parameters do not depend on any other parameter and have</span>
<span class="sd">         a value directly associated to them</span>
<span class="sd">       * DERIVED parameters are obtained from other parameters via an </span>
<span class="sd">         analytical formula.</span>

<span class="sd">       Attributes</span>
<span class="sd">       ----------</span>
<span class="sd">       name : str</span>
<span class="sd">           Random Variable name</span>
<span class="sd">       label : str</span>
<span class="sd">           Random Variable name for printing purposes</span>
<span class="sd">       value : float</span>
<span class="sd">           Current numerical value</span>
<span class="sd">       unc : float</span>
<span class="sd">           Parameter uncertainty (e.g. after minimization)</span>
<span class="sd">       bounds : list</span>
<span class="sd">           Defines, if necessary, the lower and upper bounds</span>
<span class="sd">       formula : list (optional, only for DERIVED parameters)</span>
<span class="sd">           List of operators and parameters used to parse an analytic function</span>
<span class="sd">       strform : str (optional, only for DERIVED parameters)</span>
<span class="sd">           Representation of the formula as a string</span>
<span class="sd">       partype : Param.RAW or Param.DERIVED</span>
<span class="sd">           Tells whether it is a RAW or a DERIVED parameter</span>
<span class="sd">       const : bool</span>
<span class="sd">           Tells whether a parameter is fixed during a minimazation process.</span>
<span class="sd">           It is not a constant in the sense of programming.</span>
<span class="sd">       poi :  bool</span>
<span class="sd">           Tells whether a parameter is a parameter of interest in an</span>
<span class="sd">           hypothesis test.</span>
<span class="sd">       isuptodate : bool</span>
<span class="sd">           Tells whether value needs to be computed again or not</span>
<span class="sd">       logger : logging.Logger</span>
<span class="sd">           message logging system</span>

<span class="sd">       Examples</span>
<span class="sd">       --------</span>

<span class="sd">       Declarations::</span>

<span class="sd">           &gt;&gt;&gt; import statspy as sp </span>
<span class="sd">           &gt;&gt;&gt; mu = sp.Param(name=&quot;mu&quot;,value=10.,label=&quot;\\\\mu&quot;)</span>
<span class="sd">           &gt;&gt;&gt; x = sp.Param(&quot;x = 10. +- 2.&quot;)</span>
<span class="sd">           &gt;&gt;&gt; x.value</span>
<span class="sd">           10.0</span>
<span class="sd">           &gt;&gt;&gt; x.unc</span>
<span class="sd">           2.0</span>
<span class="sd">           &gt;&gt;&gt; y = sp.Param(&quot;y = 5.&quot;, unc=1.)</span>

<span class="sd">       Operations, building DERIVED parameters::</span>

<span class="sd">           &gt;&gt;&gt; x + y</span>
<span class="sd">           x + y = 15.0 +- 2.2360679775</span>
<span class="sd">           &gt;&gt;&gt; z = x * y</span>
<span class="sd">           &gt;&gt;&gt; z.name = &#39;z&#39;</span>
<span class="sd">           &gt;&gt;&gt; z</span>
<span class="sd">           z = x * y = 50.0 +- 14.1421356237</span>
<span class="sd">           &gt;&gt;&gt; x**2</span>
<span class="sd">           x ** 2 = 100.0 +- 40.0</span>

<span class="sd">       Possible operations are ``+,-,*,/,**``.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Define the different parameter types</span>
    <span class="p">(</span><span class="n">RAW</span><span class="p">,</span><span class="n">DERIVED</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

    <span class="c"># Define derivatives for main operators</span>
    <span class="n">_derivative_add_sub</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">_derivative_mul</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">x</span><span class="p">]</span>
    <span class="n">_derivative_div</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="n">y</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">x</span><span class="o">/</span><span class="n">y</span><span class="o">/</span><span class="n">y</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># Public class members</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>    <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;label&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unc</span>     <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;unc&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;bounds&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formula</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;formula&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strform</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;strform&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">const</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;const&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poi</span>     <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;poi&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partype</span> <span class="o">=</span> <span class="n">Param</span><span class="o">.</span><span class="n">RAW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isuptodate</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span>  <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;statspy.core.Param&#39;</span><span class="p">)</span>
        <span class="c"># Internal class members</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_derivative</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;derivative&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;args = </span><span class="si">%s</span><span class="s">, kwargs = </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span><span class="n">args</span><span class="p">,</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">foundArgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_args_syntax</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">partype</span> <span class="o">=</span> <span class="n">Param</span><span class="o">.</span><span class="n">DERIVED</span>
                <span class="c">#Param._check_formula(self.formula) # &lt;= TODO</span>
                <span class="n">Param</span><span class="o">.</span><span class="n">_update_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_register_in_db</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>

<div class="viewcode-block" id="Param.__add__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__add__">[docs]</a>    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a parameter to another parameter or a numerical value.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : Param</span>
<span class="sd">        other : Param, int, long, float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : Param</span>
<span class="sd">             new parameter which is the sum of self and other</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="p">[[</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">]],</span>
                        <span class="n">strform</span><span class="o">=</span><span class="n">Param</span><span class="o">.</span><span class="n">_build_str_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;+&#39;</span><span class="p">,</span><span class="n">other</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="Param.__call__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the parameter value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self.value : float</span>
<span class="sd">            Parameter value possibly recomputed from self.formula</span>
<span class="sd">            if self.isuptodate is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</div>
<div class="viewcode-block" id="Param.__div__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__div__">[docs]</a>    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Divide a parameter by another parameter or by a numerical value.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : Param</span>
<span class="sd">        other : Param, int, long, float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : Param</span>
<span class="sd">             new parameter which is the ratio of self and other</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="p">[[</span><span class="n">operator</span><span class="o">.</span><span class="n">div</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">]],</span>
                        <span class="n">strform</span><span class="o">=</span><span class="n">Param</span><span class="o">.</span><span class="n">_build_str_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;/&#39;</span><span class="p">,</span><span class="n">other</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="Param.__getattribute__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__getattribute__">[docs]</a>    <span class="k">def</span> <span class="nf">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Overload __getattribute__ to update the value attribute from the </span>
<span class="sd">        formula for a DERIVED parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;value&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">Param</span><span class="o">.</span><span class="n">DERIVED</span> <span class="ow">and</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">isuptodate</span> <span class="o">==</span> <span class="bp">False</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;unc&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">Param</span><span class="o">.</span><span class="n">DERIVED</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_unc</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="n">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Param.__iadd__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__iadd__">[docs]</a>    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;In-place addition (+=)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : Param</span>
<span class="sd">        other : Param, int, long, float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : Param</span>
<span class="sd">             self parameter modified by other</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">Param</span><span class="o">.</span><span class="n">RAW</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">partype</span> <span class="o">=</span> <span class="n">Param</span><span class="o">.</span><span class="n">DERIVED</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isuptodate</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">formula</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">strform</span> <span class="o">=</span> <span class="n">Param</span><span class="o">.</span><span class="n">_build_str_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;+&#39;</span><span class="p">,</span><span class="n">other</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Param.__imul__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__imul__">[docs]</a>    <span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;In-place multiplication (*=)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : Param</span>
<span class="sd">        other : Param, int, long, float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : Param</span>
<span class="sd">             self parameter modified by other</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">Param</span><span class="o">.</span><span class="n">RAW</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">partype</span> <span class="o">=</span> <span class="n">Param</span><span class="o">.</span><span class="n">DERIVED</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isuptodate</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">formula</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">strform</span> <span class="o">=</span> <span class="n">Param</span><span class="o">.</span><span class="n">_build_str_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">,</span><span class="n">other</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Param.__isub__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__isub__">[docs]</a>    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;In-place subtraction (-=)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : Param</span>
<span class="sd">        other : Param, int, long, float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : Param</span>
<span class="sd">             self parameter modified by other</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">Param</span><span class="o">.</span><span class="n">RAW</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">partype</span> <span class="o">=</span> <span class="n">Param</span><span class="o">.</span><span class="n">DERIVED</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isuptodate</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">formula</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">strform</span> <span class="o">=</span> <span class="n">Param</span><span class="o">.</span><span class="n">_build_str_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="n">other</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Param.__mul__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__mul__">[docs]</a>    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiply a parameter by another parameter or by a numerical value.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : Param</span>
<span class="sd">        other : Param, int, long, float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : Param</span>
<span class="sd">             new parameter which is the product of self and other</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="p">[[</span><span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">]],</span>
                        <span class="n">strform</span><span class="o">=</span><span class="n">Param</span><span class="o">.</span><span class="n">_build_str_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">,</span><span class="n">other</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="Param.__pow__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__pow__">[docs]</a>    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raise a parameter the power.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : Param</span>
<span class="sd">        other : Param, int, long, float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : Param</span>
<span class="sd">             new parameter which is self raised to the power of other</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="p">[[</span><span class="n">operator</span><span class="o">.</span><span class="n">pow</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">]],</span>
                        <span class="n">strform</span><span class="o">=</span><span class="n">Param</span><span class="o">.</span><span class="n">_build_str_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;**&#39;</span><span class="p">,</span><span class="n">other</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="Param.__radd__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__radd__">[docs]</a>    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a numerical value to a parameter&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="p">[[</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">]],</span>
                        <span class="n">strform</span><span class="o">=</span><span class="n">Param</span><span class="o">.</span><span class="n">_build_str_formula</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="s">&#39;+&#39;</span><span class="p">,</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="Param.__rdiv__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__rdiv__">[docs]</a>    <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Divide a numerical value by a parameter&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="p">[[</span><span class="n">operator</span><span class="o">.</span><span class="n">div</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">]],</span>
                        <span class="n">strform</span><span class="o">=</span><span class="n">Param</span><span class="o">.</span><span class="n">_build_str_formula</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="s">&#39;/&#39;</span><span class="p">,</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="Param.__repr__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return Parameter value and formula if DERIVED&quot;&quot;&quot;</span>
        <span class="n">theStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strform</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> <span class="n">theStr</span> <span class="o">=</span> <span class="n">theStr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">strform</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span>
        <span class="n">theStr</span> <span class="o">=</span> <span class="n">theStr</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">theStr</span> <span class="o">=</span> <span class="n">theStr</span> <span class="o">+</span> <span class="s">&quot; +- &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">theStr</span>
</div>
<div class="viewcode-block" id="Param.__rmul__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__rmul__">[docs]</a>    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiply a numerival value by a parameter&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="p">[[</span><span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">]],</span>
                        <span class="n">strform</span><span class="o">=</span><span class="n">Param</span><span class="o">.</span><span class="n">_build_str_formula</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">,</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="Param.__rpow__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__rpow__">[docs]</a>    <span class="k">def</span> <span class="nf">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raise a numerical value to the power&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="p">[[</span><span class="n">operator</span><span class="o">.</span><span class="n">pow</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">]],</span>
                        <span class="n">strform</span><span class="o">=</span><span class="n">Param</span><span class="o">.</span><span class="n">_build_str_formula</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="s">&#39;**&#39;</span><span class="p">,</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="Param.__rsub__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__rsub__">[docs]</a>    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subtract a numerical value to a parameter&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="p">[[</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">]],</span>
                        <span class="n">strform</span><span class="o">=</span><span class="n">Param</span><span class="o">.</span><span class="n">_build_str_formula</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="Param.__setattr__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__setattr__">[docs]</a>    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Overload __setattr__ to make sure that quantities based on this</span>
<span class="sd">        parameter will be updated when its value is modified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s">&quot;value&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;value&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">update_status</span><span class="p">(</span><span class="n">_dparams</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;name&quot;</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;Cannot overwrite parameter name&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_register_in_db</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Param</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Param.__sub__"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.__sub__">[docs]</a>    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subtract a parameter to another parameter or a numerical value.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : Param</span>
<span class="sd">        other : Param, int, long, float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : Param</span>
<span class="sd">             new parameter which is the difference of self and other</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="p">[[</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">]],</span>
                        <span class="n">strform</span><span class="o">=</span><span class="n">Param</span><span class="o">.</span><span class="n">_build_str_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="n">other</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="Param.get_raw_params"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.get_raw_params">[docs]</a>    <span class="k">def</span> <span class="nf">get_raw_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the list of RAW parameters from a DERIVED parameter&quot;&quot;&quot;</span>
        <span class="n">raw_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partype</span> <span class="o">!=</span> <span class="n">Param</span><span class="o">.</span><span class="n">DERIVED</span><span class="p">:</span> <span class="k">return</span> <span class="n">raw_params</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">raw_params</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">op</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ele</span><span class="p">,</span> <span class="n">Param</span><span class="p">):</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="n">ele</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">Param</span><span class="o">.</span><span class="n">RAW</span><span class="p">:</span>
                    <span class="n">raw_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ele</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">Param</span><span class="o">.</span><span class="n">DERIVED</span><span class="p">:</span>
                    <span class="n">raw_params</span> <span class="o">+=</span> <span class="n">ele</span><span class="o">.</span><span class="n">get_raw_params</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">raw_params</span>
</div>
<div class="viewcode-block" id="Param.unbound_repr"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.unbound_repr">[docs]</a>    <span class="k">def</span> <span class="nf">unbound_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transform the value of the parameter such as it has no bounds.</span>

<span class="sd">        This method is used with the minimization algorithms which require</span>
<span class="sd">        only unbound parameters. The transformation formula from a</span>
<span class="sd">        double-sided or a one-sided parameter to an unbound parameter are </span>
<span class="sd">        described in Section 1.3.1 of the MINUIT manual:</span>
<span class="sd">        Fred James, Matthias Winkler, MINUIT User&#39;s Guide, June 16, 2004.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : float</span>
<span class="sd">            parameter value within an unbound representation.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="n">new</span> <span class="c"># Parameter has no bounds</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Parameter with double-sided limits</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">new</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Parameter with a lower bound</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">new</span> <span class="o">-</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">new</span> <span class="o">-</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">b</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Parameter with an upper bound</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">b</span> <span class="o">-</span> <span class="n">new</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">new</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="Param.unbound_to_bound"><a class="viewcode-back" href="../../Reference.html#statspy.core.Param.unbound_to_bound">[docs]</a>    <span class="k">def</span> <span class="nf">unbound_to_bound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">unc</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transform the parameter value from an unbound to a bounded </span>
<span class="sd">        representation.</span>

<span class="sd">        This method is used with the minimization algorithms which require</span>
<span class="sd">        only unbound parameters. The transformation formula from an unbound</span>
<span class="sd">        parameter to a double-sided or a one-sided parameter are described in</span>
<span class="sd">        Section 1.3.1 of the MINUIT manual:</span>
<span class="sd">        Fred James, Matthias Winkler, MINUIT User&#39;s Guide, June 16, 2004.</span>
<span class="sd">        Since the transformation is non-linear, the transformation of the</span>
<span class="sd">        uncertainty is approximate and based on the error propagation </span>
<span class="sd">        formula. In particular, when the value is close to its limit, the</span>
<span class="sd">        uncertainty is not trustable and a more refined analysis should be </span>
<span class="sd">        performed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : float</span>
<span class="sd">            parameter value within an unbound representation</span>
<span class="sd">        unc : float</span>
<span class="sd">            parameter uncertainty within an unbound representation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unc</span>   <span class="o">=</span> <span class="n">unc</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unc</span> <span class="c"># Parameter has no bounds</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Parameter with double-sided limits</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unc</span>   <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">((</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">*</span> <span class="n">unc</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Parameter with a lower bound</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="n">val</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unc</span>   <span class="o">=</span> <span class="n">val</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="n">val</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">unc</span>
        <span class="k">elif</span> <span class="n">b</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Parameter with an upper bound</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="n">val</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unc</span>   <span class="o">=</span> <span class="n">val</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="n">val</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">unc</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unc</span>
</div>
    <span class="k">def</span> <span class="nf">_check_args_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span> <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;If an argument is passed to Param without a keyword, it must be a string.&quot;</span><span class="p">)</span>
        <span class="c"># Analyse the string</span>
        <span class="n">theStr</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">theStr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">theStr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Found Param name </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">theStr</span> <span class="o">=</span> <span class="n">theStr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;+-&#39;</span> <span class="ow">in</span> <span class="n">theStr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">theStr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;+-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
            <span class="n">theStr</span> <span class="o">=</span> <span class="n">theStr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;+-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">theStr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partype</span> <span class="o">!=</span> <span class="n">Param</span><span class="o">.</span><span class="n">DERIVED</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">value</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Param</span><span class="p">):</span>
                        <span class="n">val1</span> <span class="o">=</span> <span class="n">value</span> <span class="k">if</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span> <span class="k">else</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> 
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">val1</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">val2</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Param</span><span class="p">)</span> <span class="k">else</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Param</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Param</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;operation is not recognized&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">Param</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;operation type is not recognized&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isuptodate</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_evaluate_unc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Propagation of uncertainty.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partype</span> <span class="o">!=</span> <span class="n">Param</span><span class="o">.</span><span class="n">DERIVED</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">value</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">unc</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="c"># operators +,-,*,/,**</span>
                    <span class="k">if</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">:</span>
                        <span class="n">derivative</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">x</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">operator</span><span class="o">.</span><span class="n">div</span><span class="p">:</span>
                        <span class="n">derivative</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="n">y</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">x</span><span class="o">/</span><span class="n">y</span><span class="o">/</span><span class="n">y</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">operator</span><span class="o">.</span><span class="n">pow</span><span class="p">:</span>
                        <span class="n">derivative</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">y</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> 
                                      <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">derivative</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">corr</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Param</span><span class="p">):</span>
                        <span class="n">val1</span> <span class="o">=</span> <span class="n">value</span> <span class="k">if</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span> <span class="k">else</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                        <span class="n">unc1</span> <span class="o">=</span> <span class="n">unc</span> <span class="k">if</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span> <span class="k">else</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unc</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_pcov</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Param</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_pcov</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">par</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">corr</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">val1</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">unc1</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="n">val2</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Param</span><span class="p">)</span> <span class="k">else</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">unc2</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">unc</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Param</span><span class="p">)</span> <span class="k">else</span> <span class="mf">0.</span>
                    <span class="n">df1</span> <span class="o">=</span> <span class="p">(</span><span class="n">derivative</span><span class="p">[</span><span class="mi">0</span><span class="p">])(</span><span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span>
                    <span class="n">df2</span> <span class="o">=</span> <span class="p">(</span><span class="n">derivative</span><span class="p">[</span><span class="mi">1</span><span class="p">])(</span><span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span>
                    <span class="n">unc</span> <span class="o">=</span> <span class="n">df1</span> <span class="o">*</span> <span class="n">df1</span> <span class="o">*</span> <span class="n">unc1</span> <span class="o">*</span> <span class="n">unc1</span> <span class="o">+</span> <span class="n">df2</span> <span class="o">*</span> <span class="n">df2</span> <span class="o">*</span> <span class="n">unc2</span> <span class="o">*</span> <span class="n">unc2</span>
                    <span class="k">if</span> <span class="n">corr</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span> <span class="n">unc</span> <span class="o">+=</span> <span class="n">df1</span> <span class="o">*</span> <span class="n">df2</span> <span class="o">*</span> <span class="n">corr</span> <span class="o">*</span> <span class="n">unc1</span> <span class="o">*</span> <span class="n">unc2</span>
                    <span class="k">if</span> <span class="n">unc</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&#39;Negative uncertainty.&#39;</span><span class="p">)</span>
                    <span class="n">unc</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">unc</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Param</span><span class="p">):</span>
                    <span class="c"># mathematical function</span>
                    <span class="k">if</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_derivative</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_derivative</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                            <span class="n">unc</span> <span class="o">=</span> <span class="n">df</span> <span class="o">*</span> <span class="n">df</span> <span class="o">*</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unc</span> <span class="o">*</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unc</span>
                            <span class="k">if</span> <span class="n">unc</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&#39;Negative uncertainty.&#39;</span><span class="p">)</span>
                            <span class="n">unc</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">unc</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Param</span><span class="p">):</span>
                    <span class="c"># simple copy</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                    <span class="n">unc</span> <span class="o">=</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unc</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;operation is not recognized&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">Param</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">value</span>
                <span class="n">unc</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">unc</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;operation type is not recognized&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unc</span> <span class="o">=</span> <span class="n">unc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isuptodate</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_register_in_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a parameter in database.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_dparams</span> <span class="ow">and</span> <span class="s">&#39;obj&#39;</span> <span class="ow">in</span> <span class="n">_dparams</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> already registred, remove existing info&#39;</span><span class="p">,</span>
                                <span class="n">name</span><span class="p">)</span>
        <span class="n">_dparams</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;rvs&#39;</span><span class="p">:[],</span><span class="s">&#39;pfs&#39;</span><span class="p">:[],</span><span class="s">&#39;params&#39;</span><span class="p">:[]}</span>
        <span class="n">_dparams</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;obj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Register new Param: </span><span class="si">%s</span><span class="s"> with value=</span><span class="si">%f</span><span class="s">, bounds=</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
                          <span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;and derived from formula: </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_update_db</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">par_to_add</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add par_to_add to the list of params in database&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">Param</span><span class="o">.</span><span class="n">RAW</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">_dparams</span><span class="p">[</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par_to_add</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">formula</span><span class="p">):</span> <span class="k">return</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">formula</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">op</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ele</span><span class="p">,</span> <span class="n">Param</span><span class="p">):</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">ele</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ele</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">Param</span><span class="o">.</span><span class="n">DERIVED</span><span class="p">:</span>
                            <span class="n">Param</span><span class="o">.</span><span class="n">_update_db</span><span class="p">(</span><span class="n">ele</span><span class="p">,</span> <span class="n">par_to_add</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_dparams</span><span class="p">[</span><span class="n">ele</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par_to_add</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">Param</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">Param</span><span class="o">.</span><span class="n">DERIVED</span><span class="p">:</span>
                        <span class="n">Param</span><span class="o">.</span><span class="n">_update_db</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">par_to_add</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_dparams</span><span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par_to_add</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;operation is not recognized&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_strform</span><span class="p">(</span><span class="n">par</span><span class="p">):</span>
        <span class="n">strform</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">long</span><span class="p">,</span><span class="nb">float</span><span class="p">)):</span> <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">strform</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span>
        <span class="k">elif</span> <span class="n">par</span><span class="o">.</span><span class="n">strform</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">strform</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">strform</span>
        <span class="k">return</span> <span class="n">strform</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_str_formula</span><span class="p">(</span><span class="n">par1</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">par2</span><span class="p">):</span>
        <span class="n">strform</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">par1_strform</span> <span class="o">=</span> <span class="n">Param</span><span class="o">.</span><span class="n">_get_strform</span><span class="p">(</span><span class="n">par1</span><span class="p">)</span>
        <span class="n">par2_strform</span> <span class="o">=</span> <span class="n">Param</span><span class="o">.</span><span class="n">_get_strform</span><span class="p">(</span><span class="n">par2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">par1_strform</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">par2_strform</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">op</span> <span class="o">!=</span> <span class="s">&#39;+&#39;</span> <span class="ow">and</span> <span class="n">op</span> <span class="o">!=</span> <span class="s">&#39;-&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">par1</span><span class="p">,</span> <span class="n">Param</span><span class="p">)</span> <span class="ow">and</span> <span class="n">par1</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">par1_strform</span> <span class="o">=</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="n">par1_strform</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">par2</span><span class="p">,</span> <span class="n">Param</span><span class="p">)</span> <span class="ow">and</span> <span class="n">par2</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">par2_strform</span> <span class="o">=</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="n">par2_strform</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
            <span class="n">strform</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">par1_strform</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">par2_strform</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">strform</span>
</div>
<div class="viewcode-block" id="PF"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF">[docs]</a><span class="k">class</span> <span class="nc">PF</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class to define a Probability Function. </span>

<span class="sd">       Probability Function is a generic name which includes both the</span>
<span class="sd">       probability mass function for discrete random variables and the</span>
<span class="sd">       probability density fucntion for continuous random variables.</span>
<span class="sd">       The function itself is defined in ``self.func``:</span>

<span class="sd">       * For a RAW PF, it is a pdf or a pmf of scipy.stats. </span>
<span class="sd">       * For a DERIVED PF, it is list containing an operator and </span>
<span class="sd">         pointers to other PFs.</span>

<span class="sd">       Attributes</span>
<span class="sd">       ----------</span>
<span class="sd">       name : str (optional)</span>
<span class="sd">           Function name</span>
<span class="sd">       func : scipy.stats.distributions.rv_generic, list</span>
<span class="sd">           Probability Density Function object.</span>
<span class="sd">       params : statspy.core.Param list</span>
<span class="sd">           List of shape parameters used to define the pf</span>
<span class="sd">       norm : Param</span>
<span class="sd">           Normalization parameter set to 1 by default. It can be different</span>
<span class="sd">           from 1 when the PF is fitted to data.</span>
<span class="sd">       lolc : Param, optional</span>
<span class="sd">           Location parameter</span>
<span class="sd">       scalle : Param, optional</span>
<span class="sd">           Scale parameter</span>
<span class="sd">       isuptodate : bool</span>
<span class="sd">           Tells whether PF needs to be normalized or not</span>
<span class="sd">       options : dict</span>
<span class="sd">           Potential list of options</span>
<span class="sd">       pftype : PF.RAW or PF.DERIVED</span>
<span class="sd">           Tells whether a PF is a RAW PF or DERIVED from other PFs</span>
<span class="sd">       logger : logging.Logger</span>
<span class="sd">           message logging system</span>

<span class="sd">       Examples</span>
<span class="sd">       --------</span>
<span class="sd">       &gt;&gt;&gt; import statspy as sp</span>
<span class="sd">       &gt;&gt;&gt; pmf_n = sp.PF(&quot;pmf_n=poisson(n;mu)&quot;,mu=10.)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Define the different probability function types</span>
    <span class="p">(</span><span class="n">RAW</span><span class="p">,</span><span class="n">DERIVED</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># Public class members</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isuptodate</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;options&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">=</span> <span class="n">PF</span><span class="o">.</span><span class="n">RAW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;statspy.core.PF&#39;</span><span class="p">)</span>
        <span class="c"># Internal class members</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spline_pf</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spline_cdf</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;args = </span><span class="si">%s</span><span class="s">, kwargs = </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span><span class="n">args</span><span class="p">,</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">foundArgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_args_syntax</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_kwargs_syntax</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">foundArgs</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">rv_generic</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isuptodate</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">a</span> <span class="c"># Lower bound</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">b</span> <span class="c"># Upper bound</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">rv_discrete</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">RV</span><span class="o">.</span><span class="n">DISCRETE</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">rv_continuous</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">RV</span><span class="o">.</span><span class="n">CONTINUOUS</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>

<div class="viewcode-block" id="PF.__add__"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.__add__">[docs]</a>    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add two PFs.</span>

<span class="sd">        The norm parameters are also summed.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : PF</span>
<span class="sd">        other : PF</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : PF</span>
<span class="sd">             new pf which is the sum of self and other</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">norm0</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
            <span class="n">self_params</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_add_norm_params</span><span class="p">()</span>
            <span class="n">other_params</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_get_add_norm_params</span><span class="p">()</span>
            <span class="n">add_params</span> <span class="o">=</span> <span class="n">self_params</span> <span class="o">+</span> <span class="n">other_params</span>
            <span class="n">frac0</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">add_params</span><span class="p">)</span>
            <span class="n">first</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">for</span> <span class="n">ipar</span><span class="p">,</span><span class="n">add_param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">add_params</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ipar</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="n">add_param</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">Param</span><span class="o">.</span><span class="n">RAW</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">add_param</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="mf">1.</span><span class="p">:</span>
                        <span class="n">add_param</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">frac0</span>
                    <span class="n">add_param</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">const</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="n">add_param</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">add_param</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">frac0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
                                           <span class="n">const</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">add_param</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">add_param</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;norm_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">add_param</span><span class="o">.</span><span class="n">name</span>
                <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
                    <span class="n">add_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">add_param</span><span class="o">.</span><span class="n">norm</span>
                    <span class="n">first</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">add_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">norm</span> <span class="o">-=</span> <span class="n">add_param</span><span class="o">.</span><span class="n">norm</span>
            <span class="k">if</span> <span class="n">add_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">add_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;norm_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">add_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
            <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="p">[</span><span class="n">self_params</span><span class="p">,</span> <span class="n">other_params</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">first</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">for</span> <span class="n">ipar</span><span class="p">,</span><span class="n">add_param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ele</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">ipar</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
                        <span class="n">ele</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">ele</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">norm</span> <span class="o">+</span> <span class="n">add_param</span><span class="o">.</span><span class="n">norm</span>
                        <span class="n">first</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ele</span><span class="o">.</span><span class="n">norm</span> <span class="o">+=</span> <span class="n">add_param</span><span class="o">.</span><span class="n">norm</span>
                <span class="k">if</span> <span class="n">ele</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">ele</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;norm_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ele</span><span class="o">.</span><span class="n">name</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">PF</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="p">[</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">norm0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">norm0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">new</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">norm0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">norm0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="PF.__call__"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate Probability Function in x</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args : float, ndarray, optional, multiple values for multivariate pfs</span>
<span class="sd">            Random Variable(s) value(s)</span>
<span class="sd">        kwargs : keywork arguments, optional</span>
<span class="sd">            Shape parameters values</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        value : float, ndarray</span>
<span class="sd">            Probability Function value(s) in x</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Check if self.func contains a pdf() or a pmf() method</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">RAW</span><span class="p">:</span>
            <span class="n">method_name</span> <span class="o">=</span> <span class="s">&#39;pdf&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">rv_discrete</span><span class="p">):</span>
                    <span class="n">method_name</span> <span class="o">=</span> <span class="s">&#39;pmf&#39;</span>
                <span class="n">check_method_exists</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">method_name</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="c"># Get random variable value(s), mandatory</span>
        <span class="n">rv_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_rv_values</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c"># Get shape parameters, optional</span>
        <span class="n">param_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_values</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c"># Compute pf value in x</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c">#  - in case of a DERIVED PF, call an operator</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">DERIVED</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">PF</span><span class="p">)):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">DERIVED</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&#39;DERIVED function is not recognized.&#39;</span><span class="p">)</span>
            <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># operator</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">redocache</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isuptodate</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spline_pf</span> <span class="o">==</span> <span class="bp">None</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rv_names</span><span class="p">(),</span> <span class="n">rv_values</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="ow">or</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">name</span><span class="p">])):</span>
                        <span class="n">redocache</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">redocache</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_cache</span><span class="p">(</span><span class="o">*</span><span class="n">rv_values</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spline_pf</span><span class="p">(</span><span class="o">*</span><span class="n">rv_values</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="n">the_args</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">irv</span><span class="p">,</span><span class="n">rv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">rv_names</span><span class="p">():</span>
                            <span class="n">the_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rv_values</span><span class="p">[</span><span class="n">irv</span><span class="p">])</span>
                    <span class="n">vals</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="n">idx</span><span class="p">](</span><span class="o">*</span><span class="n">the_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#  - in case of a RAW PF, call directly the scipy function</span>
            <span class="k">if</span> <span class="n">method_name</span> <span class="o">==</span> <span class="s">&#39;pmf&#39;</span><span class="p">:</span> 
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">rv_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">param_values</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">rv_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">param_values</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="PF.__mul__"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.__mul__">[docs]</a>    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiply a PF by another PF.</span>
<span class="sd">        </span>
<span class="sd">        parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : PF</span>
<span class="sd">        other : PF</span>

<span class="sd">        returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : PF</span>
<span class="sd">            new PF which is the product of self and other</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">PF</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="p">[</span><span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="PF.__rmul__"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.__rmul__">[docs]</a>    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Scale PF normalization value</span>
<span class="sd">        </span>
<span class="sd">        parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : PF</span>
<span class="sd">        scale : float</span>

<span class="sd">        returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : PF</span>
<span class="sd">            original PF with self.norm.value *= scale</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span> <span class="o">*=</span> <span class="n">scale</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="PF.cdf"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.cdf">[docs]</a>    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the cumulative distribution function in x.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args : ndarray, tuple</span>
<span class="sd">            Random Variable(s) value(s)</span>
<span class="sd">        kwargs : keywork arguments, optional</span>
<span class="sd">            Shape parameters values</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        value : float, ndarray</span>
<span class="sd">            Cumulative distribution function value(s) in x</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Check if self.func contains a cdf() method</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">RAW</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">check_method_exists</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;cdf&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="c"># Get random variable value(s), mandatory</span>
        <span class="n">rv_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_rv_values</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c"># Get shape parameters, optional</span>
        <span class="n">param_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_values</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c"># Compute cdf value in x</span>
        <span class="c">#  - in case of a DERIVED PF, call an operator</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">DERIVED</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">PF</span><span class="p">)):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">DERIVED</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&#39;DERIVED function is not recognized.&#39;</span><span class="p">)</span>
            <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">redocache</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isuptodate</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spline_cdf</span> <span class="o">==</span> <span class="bp">None</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rv_names</span><span class="p">(),</span> <span class="n">rv_values</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="ow">or</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">name</span><span class="p">])):</span>
                        <span class="n">redocache</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">redocache</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_cache</span><span class="p">(</span><span class="o">*</span><span class="n">rv_values</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spline_cdf</span><span class="p">(</span><span class="o">*</span><span class="n">rv_values</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="n">the_args</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">irv</span><span class="p">,</span><span class="n">rv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">rv_names</span><span class="p">():</span>
                            <span class="n">the_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rv_values</span><span class="p">[</span><span class="n">irv</span><span class="p">])</span>
                    <span class="n">vals</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">*</span><span class="n">the_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">op</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="c">#  - in case of a RAW PF, call directly the scipy function</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">rv_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">param_values</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PF.convolve"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.convolve">[docs]</a>    <span class="k">def</span> <span class="nf">convolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convolve two PFs which is same as adding two random variables.</span>

<span class="sd">        The scipy.signal package is used to perform the convolution with</span>
<span class="sd">        different options set by mode.</span>

<span class="sd">        parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : PF</span>
<span class="sd">        other : PF</span>
<span class="sd">        kw : keywork arguments, dict</span>
<span class="sd">            May be:</span>

<span class="sd">            * options : str</span>
<span class="sd">                Way to perform the convolution. If mode is equal to:</span>

<span class="sd">                * ``fft`` then ``scipy.signal.fftconvolve`` is used</span>
<span class="sd">                * ``num`` then ``scipy.signal.convolve`` is used</span>
<span class="sd">                * ``rvs`` then random variates are used to generate the PF</span>

<span class="sd">        returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : PF</span>
<span class="sd">            new PF which is the convolution of self and other</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method is working only for 1-dim pdf/pmf currently.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;mode&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;fft&#39;</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">PF</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;rvadd&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">],</span> <span class="n">options</span><span class="o">=</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="PF.dF"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.dF">[docs]</a>    <span class="k">def</span> <span class="nf">dF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the uncertainty on PF given the uncertainty on the shape</span>
<span class="sd">        and norm parameters.</span>

<span class="sd">        This method can be used to show an error band on your fitted PF.</span>
<span class="sd">        To compute the uncertainty on the PF, the error propagation formula is</span>
<span class="sd">        used::</span>

<span class="sd">            dF(x;th) = (F(x;th+dth) - F(x;th-dth))/2</span>
<span class="sd">            dF(x)^2 = dF(x;th)^T * corr(th,th&#39;) * dF(x;th&#39;)</span>

<span class="sd">        so keep in mind it is only an approximation.</span>

<span class="sd">        parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : float, ndarray</span>
<span class="sd">            Random variable(s) value(s)</span>

<span class="sd">        returns</span>
<span class="sd">        -------</span>
<span class="sd">        dF : float, ndarray</span>
<span class="sd">            Uncertainty on the PF evaluated in x</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Get list of free parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_list_free_params</span><span class="p">()</span>
        <span class="n">npars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">npars</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">popt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">npars</span><span class="p">)</span>
        <span class="n">punc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">npars</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ipar</span><span class="p">,</span><span class="n">par</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">):</span>
            <span class="n">popt</span><span class="p">[</span><span class="n">ipar</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">value</span>
            <span class="n">punc</span><span class="p">[</span><span class="n">ipar</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">unc</span>
        <span class="c"># Build the correlation matrix</span>
        <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">((</span><span class="n">npars</span><span class="p">,</span> <span class="n">npars</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">npars</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">npars</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&#39;covariance matrix is not defined properly&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npars</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">jpar</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npars</span><span class="p">):</span>
                    <span class="n">corr</span><span class="p">[</span><span class="n">ipar</span><span class="p">][</span><span class="n">jpar</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span><span class="p">[</span><span class="n">ipar</span><span class="p">][</span><span class="n">jpar</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">punc</span><span class="p">[</span><span class="n">ipar</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span> <span class="n">corr</span><span class="p">[</span><span class="n">ipar</span><span class="p">][</span><span class="n">jpar</span><span class="p">]</span> <span class="o">/=</span> <span class="n">punc</span><span class="p">[</span><span class="n">ipar</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">punc</span><span class="p">[</span><span class="n">jpar</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span> <span class="n">corr</span><span class="p">[</span><span class="n">ipar</span><span class="p">][</span><span class="n">jpar</span><span class="p">]</span> <span class="o">/=</span> <span class="n">punc</span><span class="p">[</span><span class="n">jpar</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">npars</span><span class="p">))</span>
        <span class="n">mcorr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>
        <span class="c"># Compute dF(x;th)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>
        <span class="n">pf_plus</span>  <span class="o">=</span> <span class="bp">None</span>
        <span class="n">pf_minus</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npars</span><span class="p">):</span>
            <span class="c"># theta -&gt; theta + deltaTheta</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">[</span><span class="n">ipar</span><span class="p">])</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="n">ipar</span><span class="p">]</span> <span class="o">+</span> <span class="n">punc</span><span class="p">[</span><span class="n">ipar</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pf_plus</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">pf_plus</span> <span class="o">=</span> <span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pf_plus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">pf_plus</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
            <span class="c"># theta -&gt; theta - deltaTheta</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">[</span><span class="n">ipar</span><span class="p">])</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="n">ipar</span><span class="p">]</span> <span class="o">-</span> <span class="n">punc</span><span class="p">[</span><span class="n">ipar</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pf_minus</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">pf_minus</span> <span class="o">=</span> <span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pf_minus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">pf_minus</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="n">dF_th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">pf_plus</span> <span class="o">-</span> <span class="n">pf_minus</span><span class="p">))</span>
        <span class="c"># Compute dF</span>
        <span class="n">dF</span> <span class="o">=</span> <span class="p">(</span><span class="n">dF_th</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">mcorr</span><span class="p">)</span> <span class="o">*</span> <span class="n">dF_th</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dF</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="PF.get_list_free_params"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.get_list_free_params">[docs]</a>    <span class="k">def</span> <span class="nf">get_list_free_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the list of free parameters.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Get the list of normalization factors</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">const</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">Param</span><span class="o">.</span><span class="n">RAW</span> <span class="ow">and</span>
            <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">DERIVED</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ele</span><span class="p">,</span> <span class="n">PF</span><span class="p">):</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ele</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">Param</span><span class="o">.</span><span class="n">RAW</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ele</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">const</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="ow">not</span> <span class="n">ele</span><span class="o">.</span><span class="n">norm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ele</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ele</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">Param</span><span class="o">.</span><span class="n">DERIVED</span><span class="p">:</span>
                    <span class="n">raw_params</span> <span class="o">=</span> <span class="n">ele</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">get_raw_params</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">raw_par</span> <span class="ow">in</span> <span class="n">raw_params</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">raw_par</span><span class="o">.</span><span class="n">const</span><span class="p">:</span> <span class="k">continue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_par</span><span class="p">)</span>
        <span class="c"># Get the list of shape parameters</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">Param</span><span class="o">.</span><span class="n">RAW</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">par</span><span class="o">.</span><span class="n">const</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">par</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">Param</span><span class="o">.</span><span class="n">DERIVED</span><span class="p">:</span>
                <span class="n">raw_params</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">get_raw_params</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">raw_par</span> <span class="ow">in</span> <span class="n">raw_params</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">raw_par</span><span class="o">.</span><span class="n">const</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">raw_par</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_par</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span>
</div>
<div class="viewcode-block" id="PF.kurtosis"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.kurtosis">[docs]</a>    <span class="k">def</span> <span class="nf">kurtosis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Estimate the kurtosis of the PF. See PF.mean() for the syntax.&quot;&quot;&quot;</span>
        <span class="n">kurtosis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="p">(</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">kurtosis</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kurtosis</span>
</div>
<div class="viewcode-block" id="PF.leastsq_fit"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.leastsq_fit">[docs]</a>    <span class="k">def</span> <span class="nf">leastsq_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">ey</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cond</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fit the PF to data using a least squares method.</span>

<span class="sd">        The fitting part is performed using the scipy.optimize.leastsq </span>
<span class="sd">        function. The Levenberg-Marquardt algorithm is used by the &#39;leastsq&#39;</span>
<span class="sd">        method to find the minimum values.</span>
<span class="sd">        When calling this method, all PF parameters are minimized except</span>
<span class="sd">        the one which are set as &#39;const&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xdata : ndarray</span>
<span class="sd">            Values for which ydata are measured and PF must be computed</span>
<span class="sd">        ydata : ndarray</span>
<span class="sd">            Observed values (like number of events)</span>
<span class="sd">        ey : ndarray (optional)</span>
<span class="sd">            Standard deviations of ydata. If not specified, it takes</span>
<span class="sd">            sqrt(ydata) as standard deviation.</span>
<span class="sd">        dx : ndarray (optional)</span>
<span class="sd">            Array containing bin-width of xdata. It can be used to normalize</span>
<span class="sd">            the PF to the integral while minimizing.</span>
<span class="sd">        cond : boolean ndarray (optional)</span>
<span class="sd">            Boolean array telling if a bin should be used in the fit or not</span>
<span class="sd">        kw : keyword arguments</span>
<span class="sd">            Keyword arguments passed to the leastsq method</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        free_params : statspy.core.Param list</span>
<span class="sd">             List of the free parameters used during the fit. Their &#39;value&#39;</span>
<span class="sd">             and &#39;unc&#39; arguments are extracted from minimization.</span>
<span class="sd">        pcov : 2d array</span>
<span class="sd">             Estimated covariance matrix of the free parameters.</span>
<span class="sd">        chi2min : float</span>
<span class="sd">             Least square sum evaluated in popt.</span>
<span class="sd">        pvalue : float</span>
<span class="sd">             p-value = P(chi2&gt;chi2min,ndf) with P a chi2 distribution and</span>
<span class="sd">             ndf the number of degrees of freedom.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Define parameters which should be minimized and set initial values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_list_free_params</span><span class="p">()</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ipar</span><span class="p">,</span><span class="n">par</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">):</span>
             <span class="n">p0</span><span class="p">[</span><span class="n">ipar</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">unbound_repr</span><span class="p">()</span>
        <span class="c"># Compute weights</span>
        <span class="k">if</span> <span class="n">ey</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>
        <span class="n">ey</span><span class="p">[</span><span class="n">ey</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="k">if</span> <span class="n">cond</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="n">cond</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span>
        <span class="c"># Call the leastsq method</span>
        <span class="k">if</span> <span class="n">dx</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">xdata</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">leastsq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_leastsq_function</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span>
                                     <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="c"># Manage results</span>
        <span class="p">(</span><span class="n">popt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span><span class="p">,</span> <span class="n">infodict</span><span class="p">,</span> <span class="n">errmsg</span><span class="p">,</span> <span class="n">ier</span><span class="p">)</span> <span class="o">=</span> <span class="n">res</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Error message from leastsq: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ier</span><span class="p">)</span> <span class="o">+</span> 
                          <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">errmsg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Optimal parameters not found: &quot;</span> <span class="o">+</span> <span class="n">errmsg</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">chi2min</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_leastsq_function</span><span class="p">(</span><span class="n">popt</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">p0</span><span class="p">))</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ndf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span> <span class="o">*</span> <span class="n">chi2min</span> <span class="o">/</span> <span class="n">ndf</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">chi2min</span><span class="p">,</span> <span class="n">ndf</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ipar</span><span class="p">,</span><span class="n">par</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">):</span>
                <span class="n">unc</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span><span class="p">)[</span><span class="n">ipar</span><span class="p">][</span><span class="n">ipar</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">:</span>
                    <span class="n">unc</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span><span class="p">)[</span><span class="n">ipar</span><span class="p">][</span><span class="n">ipar</span><span class="p">])</span>
                <span class="n">val2</span><span class="p">,</span> <span class="n">unc2</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">unbound_to_bound</span><span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="n">ipar</span><span class="p">],</span> <span class="n">unc</span><span class="p">)</span>
                <span class="n">par</span><span class="o">.</span><span class="n">_pcov</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">jpar</span><span class="p">,</span> <span class="n">par2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">unc</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span><span class="p">[</span><span class="n">ipar</span><span class="p">][</span><span class="n">jpar</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">unc2</span> <span class="o">/</span> <span class="n">unc</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span><span class="p">[</span><span class="n">jpar</span><span class="p">][</span><span class="n">ipar</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">unc2</span> <span class="o">/</span> <span class="n">unc</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">jpar</span> <span class="o">!=</span> <span class="n">ipar</span><span class="p">:</span>
                        <span class="n">par</span><span class="o">.</span><span class="n">_pcov</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">par2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span><span class="p">[</span><span class="n">jpar</span><span class="p">][</span><span class="n">ipar</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pcov</span><span class="p">,</span> <span class="n">chi2min</span><span class="p">,</span> <span class="n">pvalue</span>
</div>
<div class="viewcode-block" id="PF.loc"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.loc">[docs]</a>    <span class="k">def</span> <span class="nf">loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Derive a PF from another PF via a location parameter.</span>
<span class="sd">        </span>
<span class="sd">        parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : PF</span>
<span class="sd">        loc : Param, value</span>

<span class="sd">        returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : PF</span>
<span class="sd">            new PF with x -&gt; x + loc</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">PF</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">Param</span><span class="p">):</span>
                <span class="n">new</span><span class="o">.</span><span class="n">loc</span> <span class="o">=</span> <span class="n">loc</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new</span><span class="o">.</span><span class="n">loc</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">loc</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="PF.logpf"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.logpf">[docs]</a>    <span class="k">def</span> <span class="nf">logpf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the logarithm of the PF in x.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args : ndarray, tuple</span>
<span class="sd">            Random Variable(s) value(s)</span>
<span class="sd">        kwargs : keywork arguments, optional</span>
<span class="sd">            Shape parameters values</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        value : float, ndarray</span>
<span class="sd">            Logarithm of the Probability Function value(s) in x</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Check if self.func contains a logpdf() or a logpmf() method</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">RAW</span><span class="p">:</span>
            <span class="n">method_name</span> <span class="o">=</span> <span class="s">&#39;logpdf&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">rv_discrete</span><span class="p">):</span>
                    <span class="n">method_name</span> <span class="o">=</span> <span class="s">&#39;logpmf&#39;</span>
                <span class="n">check_method_exists</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">method_name</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="c"># Get random variable value(s), mandatory</span>
        <span class="n">rv_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_rv_values</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c"># Get shape parameters, optional</span>
        <span class="n">param_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_values</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c"># Compute logpf value in x</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c">#  - in case of a DERIVED PF, call an operator</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">DERIVED</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">PF</span><span class="p">)):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">logpf</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">DERIVED</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&#39;DERIVED function is not recognized.&#39;</span><span class="p">)</span>
            <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="n">the_args</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">irv</span><span class="p">,</span><span class="n">rv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">rv_names</span><span class="p">():</span>
                            <span class="n">the_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rv_values</span><span class="p">[</span><span class="n">irv</span><span class="p">])</span>
                    <span class="n">vals</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">logpf</span><span class="p">(</span><span class="o">*</span><span class="n">the_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;Not yet possible...&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#  - in case of a RAW PF, call directly the scipy function</span>
            <span class="k">if</span> <span class="n">method_name</span> <span class="o">==</span> <span class="s">&#39;logpmf&#39;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">logpmf</span><span class="p">(</span><span class="n">rv_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">param_values</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">rv_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">param_values</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">value</span> 
</div>
<div class="viewcode-block" id="PF.maxlikelihood_fit"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.maxlikelihood_fit">[docs]</a>    <span class="k">def</span> <span class="nf">maxlikelihood_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fit the PF to data using the maximum likelihood estimator method.</span>

<span class="sd">        The fitting part is performed using one of the scipy.optimize </span>
<span class="sd">        minimization function. By default scipy.optimize.fmin is used, i.e.</span>
<span class="sd">        the downhill simplex algorithm.</span>
<span class="sd">        When calling this method, all PF parameters are minimized except</span>
<span class="sd">        the one which are set as &#39;const&#39; before calling the method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : ndarray, tuple</span>
<span class="sd">            Data used in the computation of the (log-)likelihood function</span>
<span class="sd">        kw : keyword arguments (optional)</span>
<span class="sd">            Keyword arguments such as</span>

<span class="sd">            optimizer : scipy.optimize function</span>
<span class="sd">                Function performing the minimization. A list of minimizer is </span>
<span class="sd">                available from scipy.optimize. If you provide your own, the</span>
<span class="sd">                callable function must be defined with func and x0 as the </span>
<span class="sd">                first two arguments. Data are passed via the args. </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        free_params : statspy.core.Param list</span>
<span class="sd">             List of the free parameters used during the fit. Their &#39;value&#39;</span>
<span class="sd">             arguments are extracted from the minimization process.</span>
<span class="sd">        nnlfmin : float</span>
<span class="sd">             Minimal value of the negative log-likelihood function</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Define parameters which should be minimized and set initial values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_list_free_params</span><span class="p">()</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ipar</span><span class="p">,</span><span class="n">par</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">):</span>
             <span class="n">p0</span><span class="p">[</span><span class="n">ipar</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">unbound_repr</span><span class="p">()</span>
        <span class="c"># Define and call the optimizer</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;optimizer&#39;</span><span class="p">,</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">fmin</span><span class="p">)</span>
        <span class="n">popt</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nllf</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">),</span> <span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c"># Manage results</span>
        <span class="k">for</span> <span class="n">ipar</span><span class="p">,</span><span class="n">par</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">):</span>
            <span class="n">val2</span><span class="p">,</span> <span class="n">unc2</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">unbound_to_bound</span><span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="n">ipar</span><span class="p">])</span>
            <span class="n">par</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">val2</span>
        <span class="n">nllfmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nllf</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">,</span> <span class="n">nllfmin</span>
</div>
<div class="viewcode-block" id="PF.mean"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.mean">[docs]</a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Estimate the mean of the PF.</span>

<span class="sd">        Warning:</span>

<span class="sd">        * In the case of a RAW PF from ``scipy.stats``, it calls the ``stats`` </span>
<span class="sd">          method and therefore returns the expected value.</span>
<span class="sd">        * In the case of a DERIVED PF, it returns an estimate derived from </span>
<span class="sd">          random variates and using the ``numpy.mean`` function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        kw : keywork arguments, optional</span>
<span class="sd">            Shape parameters values</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mean : ndarray</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mean</span>
</div>
<div class="viewcode-block" id="PF.nllf"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.nllf">[docs]</a>    <span class="k">def</span> <span class="nf">nllf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the negative log-likelihood function::</span>

<span class="sd">            nllf = -sum_i(log(pf(x_i;params))</span>

<span class="sd">        ``sum`` runs over the x-variates defined in data array.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : ndarray, tuple</span>
<span class="sd">            x - variates used in the computation of the likelihood </span>
<span class="sd">        kw : keyword arguments (optional)</span>
<span class="sd">            Specify any Parameter name of the considered PF</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        nllf : float</span>
<span class="sd">            Negative log-likelihood function</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Update values of non-const PF parameters if specified in **kw</span>
        <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
                <span class="n">par</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="c"># Compute nllf</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">nllf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logpf</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nllf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logpf</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">nllf</span>
</div>
<div class="viewcode-block" id="PF.pllr"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.pllr">[docs]</a>    <span class="k">def</span> <span class="nf">pllr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the profile log-likelihood ratio ( * -2 )</span>

<span class="sd">        The profile likelihood ratio is defined by::</span>

<span class="sd">            l = L(x|theta_r,\hat{\hat{theta_s}}) / L(x|\hat{theta_r},\hat{theta_s})</span>

<span class="sd">        The profile log-likehood ratio is then::</span>

<span class="sd">            q = -2 * log(l)</span>

<span class="sd">        Where</span>

<span class="sd">        * L is the Likelihood function (computed via data)</span>
<span class="sd">        * theta_r is the list of parameters of interest (Param.poi = True)</span>
<span class="sd">        * theta_s is the list of nuisance parameters</span>
<span class="sd">        * hat or double hat refers to the unconditional and conditional</span>
<span class="sd">          maximum likelilood estimates of the parameters respectively.</span>

<span class="sd">        pllr is used as a test statistics for problems with numerous </span>
<span class="sd">        nuisance parameters. Asymptotically, the pllr PF is described by a</span>
<span class="sd">        chi2 distribution (Wilks theorem).</span>
<span class="sd">        Further information on the likelihood ratio can be found in Chapter </span>
<span class="sd">        22 of &quot;Kendall&#39;s Advanced Theory of Statistics, Volume 2A&quot;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : ndarray, tuple</span>
<span class="sd">            x - variates used in the computation of the likelihood </span>
<span class="sd">        kw : keyword arguments (optional)</span>
<span class="sd">            Specify any Parameter of interest name of the considered PF,</span>
<span class="sd">            or any option used by the method maxlikelihood_fit.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pllf : float</span>
<span class="sd">            Profile log-likelihood ratio times -2</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Find the free parameters and the parameters of interest </span>
        <span class="c"># Update values of non-const PF parameters if specified in **kw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_list_free_params</span><span class="p">()</span>
        <span class="n">lpois</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">par</span><span class="o">.</span><span class="n">poi</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">lpois</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
                <span class="n">par</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="c"># Compute the conditional nllf (pois are fixed)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">poi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lpois</span><span class="p">):</span>
            <span class="n">poi</span><span class="o">.</span><span class="n">const</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">cond_params</span><span class="p">,</span> <span class="n">cond_nllf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlikelihood_fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">poi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lpois</span><span class="p">):</span>
            <span class="n">poi</span><span class="o">.</span><span class="n">const</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c"># Compute the unconditional nllf (pois are treated as free parameters)</span>
        <span class="n">uncond_params</span><span class="p">,</span> <span class="n">uncond_nllf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlikelihood_fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="c"># Evaluate the pllr</span>
        <span class="n">pllr</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">cond_nllf</span> <span class="o">-</span> <span class="n">uncond_nllf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pllr</span>
</div>
<div class="viewcode-block" id="PF.rvadd"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.rvadd">[docs]</a>    <span class="k">def</span> <span class="nf">rvadd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Operation equivalent to adding two random variables.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="PF.rvdiv"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.rvdiv">[docs]</a>    <span class="k">def</span> <span class="nf">rvdiv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Operation equivalent to dividing two random variables.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">PF</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;rvdiv&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">],</span> <span class="n">options</span><span class="o">=</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="PF.rvmul"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.rvmul">[docs]</a>    <span class="k">def</span> <span class="nf">rvmul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Operation equivalent to multiplying two random variables.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">PF</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;rvmul&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">],</span> <span class="n">options</span><span class="o">=</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="PF.rvs"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.rvs">[docs]</a>    <span class="k">def</span> <span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get random variates from a PF</span>

<span class="sd">        Keyword arguments</span>
<span class="sd">        -----------------</span>
<span class="sd">        size : int</span>
<span class="sd">             Number of random variates</span>
<span class="sd">        mu, sigma,... : float</span>
<span class="sd">             Any parameter name used while declaring the PF</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : ndarray</span>
<span class="sd">             Array of random variates</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import statspy as sp</span>
<span class="sd">        &gt;&gt;&gt; pdf_x = sp.PF(&quot;pdf_x=norm(x;mu=20,sigma=5)&quot;)</span>
<span class="sd">        &gt;&gt;&gt; data = pdf_x.rvs(size=1000)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">auto_loc</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">auto_loc</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">:</span>
                        <span class="n">data1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="n">data2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="n">data3</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data1</span><span class="p">))</span>
                        <span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="n">data3</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">cond</span> <span class="o">*</span> <span class="n">data1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cond</span><span class="p">)</span> <span class="o">*</span> <span class="n">data2</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;rvadd&#39;</span><span class="p">:</span>
                        <span class="n">data1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="n">data2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">data1</span> <span class="o">+</span> <span class="n">data2</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;rvsub&#39;</span><span class="p">:</span>
                        <span class="n">data1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="n">data2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">data1</span> <span class="o">-</span> <span class="n">data2</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;rvmul&#39;</span><span class="p">:</span>
                        <span class="n">data1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="n">data2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">data1</span> <span class="o">*</span> <span class="n">data2</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;rvdiv&#39;</span><span class="p">:</span>
                        <span class="n">data1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="n">data2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">data1</span> <span class="o">/</span> <span class="n">data2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;Not yet implemented...&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">PF</span><span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;Not yet implemented...&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">method_name</span> <span class="o">=</span> <span class="s">&quot;rvs&quot;</span>
                <span class="n">check_method_exists</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">method_name</span><span class="p">)</span>
                <span class="n">shape_params</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                        <span class="n">param</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                    <span class="n">shape_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="o">*</span><span class="n">shape_params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">auto_loc</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="PF.rvsub"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.rvsub">[docs]</a>    <span class="k">def</span> <span class="nf">rvsub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Operation equivalent to subtracting two random variables.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;mode&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;fft&#39;</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">PF</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;rvsub&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">],</span> <span class="n">options</span><span class="o">=</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="PF.rv_names"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.rv_names">[docs]</a>    <span class="k">def</span> <span class="nf">rv_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of RV names.&quot;&quot;&quot;</span>
        <span class="n">rv_names</span> <span class="o">=</span> <span class="p">[</span> <span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">rv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span> <span class="p">]</span>
        <span class="k">return</span> <span class="n">rv_names</span>
</div>
<div class="viewcode-block" id="PF.scale"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.scale">[docs]</a>    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Derive a PF from another PF via a scale parameter.</span>
<span class="sd">        </span>
<span class="sd">        parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : PF</span>
<span class="sd">        scale : Param, value</span>

<span class="sd">        returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : PF</span>
<span class="sd">            new PF with x -&gt; x * scale</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">PF</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">Param</span><span class="p">):</span>
                <span class="n">new</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="PF.sf"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.sf">[docs]</a>    <span class="k">def</span> <span class="nf">sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the survival function (1 - cdf) in x.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args : ndarray, tuple</span>
<span class="sd">            Random Variable(s) value(s)</span>
<span class="sd">        kwargs : keywork arguments, optional</span>
<span class="sd">            Shape parameters values</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        value : float, ndarray</span>
<span class="sd">            Survival function value(s) in x</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Check if self.func contains an sf() method</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">RAW</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">check_method_exists</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;sf&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="c"># Get random variable value(s), mandatory</span>
        <span class="n">rv_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_rv_values</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c"># Get shape parameters, optional</span>
        <span class="n">param_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_values</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c"># Compute sf value in x</span>
        <span class="c">#  - in case of a DERIVED PF, call an operator</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">DERIVED</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">PF</span><span class="p">)):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">DERIVED</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&#39;DERIVED function is not recognized.&#39;</span><span class="p">)</span>
            <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">redocache</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isuptodate</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spline_cdf</span> <span class="o">==</span> <span class="bp">None</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rv_names</span><span class="p">(),</span> <span class="n">rv_values</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="ow">or</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">name</span><span class="p">])):</span>
                        <span class="n">redocache</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">redocache</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_cache</span><span class="p">(</span><span class="o">*</span><span class="n">rv_values</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spline_cdf</span><span class="p">(</span><span class="o">*</span><span class="n">rv_values</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="n">the_args</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">irv</span><span class="p">,</span><span class="n">rv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">rv_names</span><span class="p">():</span>
                            <span class="n">the_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rv_values</span><span class="p">[</span><span class="n">irv</span><span class="p">])</span>
                    <span class="n">vals</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="o">*</span><span class="n">the_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">op</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="c">#  - in case of a RAW PF, call directly the scipy function</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">rv_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">param_values</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PF.skew"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.skew">[docs]</a>    <span class="k">def</span> <span class="nf">skew</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Estimate the skewness of the PF. See PF.mean() for the syntax.&quot;&quot;&quot;</span>
        <span class="n">skew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">skew</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">skew</span>
</div>
<div class="viewcode-block" id="PF.std"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.std">[docs]</a>    <span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Estimate the standard deviation of the PF.</span>
<span class="sd">        See PF.mean() for the syntax.&quot;&quot;&quot;</span>
        <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PF.var"><a class="viewcode-back" href="../../Reference.html#statspy.core.PF.var">[docs]</a>    <span class="k">def</span> <span class="nf">var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Estimate the variance of the PF. See PF.mean() for the syntax.&quot;&quot;&quot;</span>
        <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">var</span>
</div>
    <span class="k">def</span> <span class="nf">_build_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rv_values</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&#39;_build_cache, self.func is not a list.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&#39;self.func has a size lower than 3.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&#39;First element of self.func should be a str.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_rvs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">_rvs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&#39;self and other should have the same number of rvs.&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rv1</span><span class="p">,</span><span class="n">rv2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_rvs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">_rvs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rv1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">rv2</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="k">continue</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="s"> should be of the same type.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rv1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv2</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">])))(</span><span class="n">rv_values</span><span class="o">=</span><span class="n">rv_values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isuptodate</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_build_cache_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate random variates and build an histogram&quot;&quot;&quot;</span>
        <span class="n">size0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">,</span> <span class="mi">100000</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;size&#39;</span><span class="p">,</span> <span class="n">size0</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">RV</span><span class="o">.</span><span class="n">DISCRETE</span><span class="p">:</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span>
            <span class="n">nbins</span> <span class="o">=</span> <span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span>
            <span class="n">pf</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pf</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">rv_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="n">rv_name</span><span class="p">,</span><span class="nb">float</span><span class="p">),(</span><span class="s">&#39;pf&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">),(</span><span class="s">&#39;cdf&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">recarray</span><span class="p">(</span><span class="n">pf</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">rv_name</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c"># Bin centers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">pf</span> <span class="o">=</span> <span class="n">pf</span>                               <span class="c"># Bin contents</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">RV</span><span class="o">.</span><span class="n">CONTINUOUS</span><span class="p">:</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>                     <span class="c"># Bin widths</span>
            <span class="n">integral</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">pf</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">pf</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">integral</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">pf</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">pf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">integral</span>

    <span class="k">def</span> <span class="nf">_build_spline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&#39;cache is empty, cannot build the spline&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;spline&#39;</span><span class="p">,</span>
                                      <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">UnivariateSpline</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spline_pf</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">pf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spline_cdf</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">cdf</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;spline&#39;</span><span class="p">,</span>
                                      <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">RectBivariateSpline</span><span class="p">)</span>
            <span class="n">name1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spline_pf</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">name1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">name2</span><span class="p">],</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">pf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spline_cdf</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">name1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">name2</span><span class="p">],</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">cdf</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_check_args_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span> <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;If an argument is passed to PF without a keyword, it must be a string.&quot;</span><span class="p">)</span>
        <span class="c"># Analyse the string</span>
        <span class="n">theStr</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">theStr</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;No pf found in </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">theStr</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;)&#39;</span> <span class="ow">in</span> <span class="n">theStr</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;Paranthesis is not closed in </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">theStr</span><span class="p">)</span>
        <span class="n">func_name</span> <span class="o">=</span> <span class="n">theStr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">func_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">func_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;norm_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Found PF name </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">func_name</span> <span class="o">=</span> <span class="n">func_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">func_name</span><span class="o">.</span><span class="n">split</span><span class="p">()):</span> <span class="n">func_name</span> <span class="o">=</span> <span class="n">func_name</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">func_name</span> <span class="ow">in</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">__all__</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> is not found in scipy.stats&quot;</span> <span class="o">%</span> <span class="n">func_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Found scipy.stats function named </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span><span class="n">func_name</span><span class="p">)</span>
        <span class="n">rvNames</span>  <span class="o">=</span> <span class="n">theStr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
        <span class="n">parNames</span> <span class="o">=</span> <span class="n">rvNames</span>
        <span class="k">if</span> <span class="s">&#39;;&#39;</span> <span class="ow">in</span> <span class="n">rvNames</span><span class="p">:</span>
            <span class="n">rvNames</span>  <span class="o">=</span> <span class="n">rvNames</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
            <span class="n">parNames</span> <span class="o">=</span> <span class="n">parNames</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
        <span class="k">elif</span> <span class="s">&#39;|&#39;</span> <span class="ow">in</span> <span class="n">rvNames</span><span class="p">:</span>
            <span class="n">rvNames</span>  <span class="o">=</span> <span class="n">rvNames</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
            <span class="n">parNames</span> <span class="o">=</span> <span class="n">parNames</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parNames</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">rv_name</span> <span class="ow">in</span> <span class="n">rvNames</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">rv_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rv_names</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rv_name</span><span class="p">,</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="n">RV</span><span class="o">.</span><span class="n">UNKNOWN</span><span class="p">])</span>
        <span class="n">lpars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">parNames</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">par_name</span> <span class="ow">in</span> <span class="n">parNames</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">):</span>
                <span class="n">lpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_declare</span><span class="p">(</span><span class="n">func_name</span><span class="p">,</span><span class="n">lpars</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_check_kwargs_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">foundArgs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="s">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;self.name is already set to </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;norm_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">_dparams</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">_dparams</span><span class="p">[</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;pfs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">foundArgs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s">&#39;func&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;You cannot declare a PF without specifying a function to caracterize it.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;func&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;self.func already exists.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;func&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">=</span> <span class="n">PF</span><span class="o">.</span><span class="n">DERIVED</span>
                <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ele</span><span class="p">,</span> <span class="n">PF</span><span class="p">):</span> <span class="k">continue</span>
                    <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">ele</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">par</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">rv</span> <span class="ow">in</span> <span class="n">ele</span><span class="o">.</span><span class="n">_rvs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span> <span class="ow">and</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;rv&#39;</span><span class="p">)):</span>
                            <span class="c"># For operations on RVs, the number of RVs is </span>
                            <span class="c"># equal to the number of RVs for func[1] or </span>
                            <span class="c"># func[2]</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_rvs</span><span class="p">):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="ow">not</span> <span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rv_names</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="c"># Tricky operators like convolution requiring a cache</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_build_cache</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">=</span> <span class="n">PF</span><span class="o">.</span><span class="n">RAW</span>
        <span class="k">if</span> <span class="s">&#39;param&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> 
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;self.params are already declared.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;params&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;params should be a list.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;params&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">_dparams</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">_dparams</span><span class="p">[</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;pfs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">!=</span> <span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">param</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> value is updated to </span><span class="si">%f</span><span class="s">&#39;</span><span class="p">,</span>
                                  <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_declare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">lpars</span><span class="p">):</span>
        <span class="c"># Declare functional form of PF (no shape parameter specified yet)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span><span class="n">func_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">=</span> <span class="n">PF</span><span class="o">.</span><span class="n">RAW</span>
        <span class="c"># Declare/Update parameters</span>
        <span class="k">for</span> <span class="n">parStr</span> <span class="ow">in</span> <span class="n">lpars</span><span class="p">:</span>
            <span class="n">parName</span> <span class="o">=</span> <span class="n">parStr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
            <span class="n">parVal</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">if</span> <span class="s">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">parStr</span><span class="p">:</span>
                <span class="n">parVal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parStr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parName</span> <span class="ow">in</span> <span class="n">_dparams</span><span class="p">:</span>
                <span class="n">_dparams</span><span class="p">[</span><span class="n">parName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;rvs&#39;</span><span class="p">:[],</span><span class="s">&#39;pfs&#39;</span><span class="p">:[]}</span>
                <span class="n">_dparams</span><span class="p">[</span><span class="n">parName</span><span class="p">][</span><span class="s">&#39;obj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">parName</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">parVal</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">_dparams</span><span class="p">[</span><span class="n">parName</span><span class="p">][</span><span class="s">&#39;pfs&#39;</span><span class="p">]:</span>
                    <span class="n">_dparams</span><span class="p">[</span><span class="n">parName</span><span class="p">][</span><span class="s">&#39;pfs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">_dparams</span><span class="p">[</span><span class="n">parName</span><span class="p">][</span><span class="s">&#39;pfs&#39;</span><span class="p">]:</span>
                    <span class="n">_dparams</span><span class="p">[</span><span class="n">parName</span><span class="p">][</span><span class="s">&#39;pfs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_dparams</span><span class="p">[</span><span class="n">parName</span><span class="p">][</span><span class="s">&#39;obj&#39;</span><span class="p">])</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">RAW</span><span class="p">:</span>
            <span class="n">method_name</span> <span class="o">=</span> <span class="s">&#39;stats&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">check_method_exists</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">method_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">stats</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;m&#39;</span><span class="p">,</span><span class="s">&#39;v&#39;</span><span class="p">,</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="s">&#39;k&#39;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;stats str should be among [&#39;mvsk&#39;]&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="c"># Get shape parameters, optional</span>
            <span class="n">param_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_values</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="n">estimate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">stats</span><span class="p">(</span><span class="o">*</span><span class="n">param_values</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="n">stats</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;size&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="n">estimate</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">estimate</span>

    <span class="k">def</span> <span class="nf">_get_add_norm_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">norm_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">DERIVED</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ele</span><span class="p">,</span> <span class="n">PF</span><span class="p">):</span> <span class="k">continue</span>
                <span class="n">raw_norm_params</span> <span class="o">+=</span> <span class="n">ele</span><span class="o">.</span><span class="n">_get_add_norm_params</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">partype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">RAW</span><span class="p">:</span>
            <span class="n">norm_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">norm_params</span>

    <span class="k">def</span> <span class="nf">_get_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">rv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">rv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="ow">or</span> <span class="n">b</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                <span class="n">nsigma</span> <span class="o">=</span> <span class="mi">10</span>
                <span class="n">std</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">-</span> <span class="n">nsigma</span> <span class="o">*</span> <span class="n">std</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">a</span>
                <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">+</span> <span class="n">nsigma</span> <span class="o">*</span> <span class="n">std</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">b</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">a</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">rv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">RV</span><span class="o">.</span><span class="n">DISCRETE</span><span class="p">:</span> <span class="n">mean</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
            <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">mean</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">bounds</span>

    <span class="k">def</span> <span class="nf">_get_param_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">param_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ipar</span><span class="p">,</span><span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">!=</span> <span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">param</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> value is updated to </span><span class="si">%f</span><span class="s">&#39;</span><span class="p">,</span>
                                  <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">param_values</span><span class="p">[</span><span class="n">ipar</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">param_values</span>

    <span class="k">def</span> <span class="nf">_get_rv_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">rv_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">rv_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rv_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">rv_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rv_names</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">rv_name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">rv_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">rv_name</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pftype</span> <span class="o">==</span> <span class="n">PF</span><span class="o">.</span><span class="n">RAW</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rv_values</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&#39;Provide </span><span class="si">%s</span><span class="s"> input arguments for rvs&#39;</span> <span class="o">%</span> 
                              <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rv_values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;rv values=</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">rv_values</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rv_values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rv_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">rv_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rv_values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">):</span>
            <span class="n">rv_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">rv_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">rv_values</span>

    <span class="k">def</span> <span class="nf">_leastsq_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">dx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function used by scipy.optimize.leastsq&quot;&quot;&quot;</span>
        <span class="c"># Update values of non-const PF parameters</span>
        <span class="k">for</span> <span class="n">ipar</span><span class="p">,</span><span class="n">par</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">):</span>
            <span class="n">par</span><span class="o">.</span><span class="n">unbound_to_bound</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">ipar</span><span class="p">])</span>
        <span class="c"># Return delta = (PF(x) - y)/sigma</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">-</span> <span class="n">ydata</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">delta</span>

    <span class="k">def</span> <span class="nf">_nllf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the negative log-likelihood function using unbound </span>
<span class="sd">        parameters&quot;&quot;&quot;</span>
        <span class="c"># Update values of non-const PF parameters</span>
        <span class="k">for</span> <span class="n">ipar</span><span class="p">,</span><span class="n">par</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_free_params</span><span class="p">):</span>
            <span class="n">par</span><span class="o">.</span><span class="n">unbound_to_bound</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">ipar</span><span class="p">])</span>
        <span class="c"># Compute nllf</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">nllf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logpf</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nllf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logpf</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">nllf</span>

    <span class="k">def</span> <span class="nf">_rvadd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rv_values</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convolve numerically two PFs and store the result in _cache.&quot;&quot;&quot;</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;mode&#39;</span><span class="p">,</span> <span class="s">&#39;fft&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;num&#39;</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;fft&#39;</span><span class="p">:</span>
            <span class="c"># Define the rv bounds</span>
            <span class="n">rv1_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_get_bounds</span><span class="p">()</span>
            <span class="n">rv2_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">_get_bounds</span><span class="p">()</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">npts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;size&#39;</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rv1</span><span class="p">,</span><span class="n">rv2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rv1_bounds</span><span class="p">,</span><span class="n">rv2_bounds</span><span class="p">):</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;rvadd&#39;</span><span class="p">:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">rv1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rv2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">rv1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">rv2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">rv1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">rv2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">rv1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">rv2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">rv1</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">rv2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                        <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">value</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">rv1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">rv2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">rv1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rv2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">rv1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">rv2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">rv1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">rv2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">rv1</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">rv2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                    <span class="n">wdt</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">wdt</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">wdt</span>
                <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">])</span>
            <span class="c"># TODO, algo is problematic when &gt; 1 rv</span>
            <span class="k">for</span> <span class="n">rv</span><span class="p">,</span><span class="n">bound</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">,</span><span class="n">bounds</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">rv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">RV</span><span class="o">.</span><span class="n">CONTINUOUS</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">bound</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">bound</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">bound</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">bound</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">npts</span><span class="p">:</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">npts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="n">npts</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">npts</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c"># Arrays of axis coordinates</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">rv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">RV</span><span class="o">.</span><span class="n">CONTINUOUS</span><span class="p">:</span>
                    <span class="n">dtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">float</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">int</span><span class="p">))</span>
            <span class="n">dtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;pf&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span>
            <span class="n">dtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;cdf&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="n">npts</span><span class="p">,),</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">args1</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">args2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">bin_area</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">step</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">for</span> <span class="n">rv</span><span class="p">,</span><span class="n">bound</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">,</span><span class="n">bounds</span><span class="p">):</span>
                <span class="n">rv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">rv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">bound</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bound</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                                       <span class="n">num</span><span class="o">=</span><span class="n">npts</span><span class="p">,</span> <span class="n">retstep</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">bin_area</span> <span class="o">*=</span> <span class="n">step</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">args1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">rv1_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
                    <span class="n">args2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">rv2_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">args1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="n">args2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> bounds set to </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bound</span><span class="p">))</span>
            <span class="c"># Evaluate pf values for both input pf</span>
            <span class="n">pf1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="o">*</span><span class="n">args1</span><span class="p">)</span>
            <span class="n">pf2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">2</span><span class="p">](</span><span class="o">*</span><span class="n">args2</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;rvsub&#39;</span><span class="p">:</span> <span class="n">pf2</span> <span class="o">=</span> <span class="n">pf2</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c"># Perform the convolution</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;num&#39;</span><span class="p">:</span>
                <span class="n">pf</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">pf1</span><span class="p">,</span> <span class="n">pf2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;full&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pf</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">fftconvolve</span><span class="p">(</span><span class="n">pf1</span><span class="p">,</span> <span class="n">pf2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;full&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;rvadd&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;rvsub&#39;</span> <span class="ow">and</span> <span class="mi">0</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">npts</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="n">npts</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">pf</span> <span class="o">=</span> <span class="n">pf</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="n">npts</span><span class="p">]</span>
            <span class="c"># Cumulative distribution function</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">pf</span> <span class="o">*</span> <span class="n">bin_area</span><span class="p">)</span>
            <span class="c"># Normalization factor</span>
            <span class="n">integral</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">pf</span> <span class="o">*</span> <span class="n">bin_area</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">integral</span>
            <span class="c"># Interpolation setup</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;spline&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;spline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;spline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;spline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># Generate random variated and build an histogram</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_cache_rvs</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;Sorry, rvadd operation not valid...&#39;</span><span class="p">)</span>
        <span class="c"># Interpolate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_spline</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_rvdiv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rv_values</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_cache_rvs</span><span class="p">()</span>
        <span class="c"># Interpolate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_spline</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_rvmul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rv_values</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_cache_rvs</span><span class="p">()</span>
        <span class="c"># Interpolate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_spline</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_rvsub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rv_values</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rvadd</span><span class="p">(</span><span class="n">rv_values</span><span class="o">=</span><span class="n">rv_values</span><span class="p">)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="RV"><a class="viewcode-back" href="../../Reference.html#statspy.core.RV">[docs]</a><span class="k">class</span> <span class="nc">RV</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class to define a Random Variable. </span>

<span class="sd">       Attributes</span>
<span class="sd">       ----------</span>
<span class="sd">       name : str</span>
<span class="sd">           Random Variable name</span>
<span class="sd">       pf : statspy.core.PF</span>
<span class="sd">           Probability Function object associated to a Random Variable</span>
<span class="sd">       rvtype : RV.CONTINUOUS or RV.DISCRETE</span>
<span class="sd">           Random Variable type</span>
<span class="sd">       logger : logging.Logger</span>
<span class="sd">           message logging system</span>

<span class="sd">       Examples</span>
<span class="sd">       --------</span>
<span class="sd">       &gt;&gt;&gt; import statspy as sp </span>
<span class="sd">       &gt;&gt;&gt; X = sp.RV(&quot;norm(x|mu=10,sigma=2)&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Define the different random value types</span>
    <span class="p">(</span><span class="n">UNKNOWN</span><span class="p">,</span><span class="n">CONTINUOUS</span><span class="p">,</span><span class="n">DISCRETE</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pf</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rvtype</span> <span class="o">=</span> <span class="n">RV</span><span class="o">.</span><span class="n">UNKNOWN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;statspy.core.RV&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;args = </span><span class="si">%s</span><span class="s">, kwargs = </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
            <span class="n">foundArgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_args_syntax</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_kwargs_syntax</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">foundArgs</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>

<div class="viewcode-block" id="RV.__add__"><a class="viewcode-back" href="../../Reference.html#statspy.core.RV.__add__">[docs]</a>    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add two random variables or a random variable by a parameter.</span>

<span class="sd">        The associated PF of the sum of the two random variables is</span>
<span class="sd">        a convolution of the two PFs.</span>
<span class="sd">        Caveat: this method assumes *independent* random variables.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : RV</span>
<span class="sd">        other : RV, Param, value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : RV</span>
<span class="sd">             new RV which is the sum of self and other</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">RV</span><span class="p">):</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">RV</span><span class="p">(</span><span class="n">pf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">rvadd</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">pf</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">RV</span><span class="p">(</span><span class="n">pf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">loc</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="RV.__call__"><a class="viewcode-back" href="../../Reference.html#statspy.core.RV.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get random variates</span>

<span class="sd">        Keyword arguments</span>
<span class="sd">        -----------------</span>
<span class="sd">        size : int</span>
<span class="sd">             Number of random variates</span>
<span class="sd">        mu, sigma,... : float</span>
<span class="sd">             Any parameter name used while declaring the PF</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : ndarray</span>
<span class="sd">             Array of random variates</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import statspy as sp</span>
<span class="sd">        &gt;&gt;&gt; X = sp.RV(&quot;norm(x;mu=20,sigma=5)&quot;)</span>
<span class="sd">        &gt;&gt;&gt; x = X(size=1000)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="p">,</span> <span class="n">PF</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&#39;No PF associated to this random variable.&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="RV.__div__"><a class="viewcode-back" href="../../Reference.html#statspy.core.RV.__div__">[docs]</a>    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Divide two random variables or a random variable by a parameter.</span>

<span class="sd">        Caveat: this method assumes *independent* random variables.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : RV</span>
<span class="sd">        other : RV, Param, value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : RV</span>
<span class="sd">             new RV which is the ratio of self and other</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">RV</span><span class="p">):</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">RV</span><span class="p">(</span><span class="n">pf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">rvdiv</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">pf</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">RV</span><span class="p">(</span><span class="n">pf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">scale</span><span class="p">((</span><span class="mf">1.</span><span class="o">/</span><span class="n">other</span><span class="p">)))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="RV.__mul__"><a class="viewcode-back" href="../../Reference.html#statspy.core.RV.__mul__">[docs]</a>    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiply two random variables or a random variable by a parameter.</span>

<span class="sd">        Caveat: this method assumes *independent* random variables.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : RV</span>
<span class="sd">        other : RV, Param, value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : RV</span>
<span class="sd">             new RV which is the product of self and other</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">RV</span><span class="p">):</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">RV</span><span class="p">(</span><span class="n">pf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">rvmul</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">pf</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">RV</span><span class="p">(</span><span class="n">pf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="RV.__radd__"><a class="viewcode-back" href="../../Reference.html#statspy.core.RV.__radd__">[docs]</a>    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a random variable and a parameter.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : RV</span>
<span class="sd">        other : Param, value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : RV</span>
<span class="sd">             new RV which is the sum of self and other</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">RV</span><span class="p">(</span><span class="n">pf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">loc</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="RV.__rmul__"><a class="viewcode-back" href="../../Reference.html#statspy.core.RV.__rmul__">[docs]</a>    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiply a parameter by a random variable.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : RV</span>
<span class="sd">        other : Param, value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : RV</span>
<span class="sd">             new RV which is the product of self and other</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">RV</span><span class="p">(</span><span class="n">pf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="RV.__sub__"><a class="viewcode-back" href="../../Reference.html#statspy.core.RV.__sub__">[docs]</a>    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subtract two random variables or a random variable by a parameter.</span>

<span class="sd">        Caveat: this method assumes *independent* random variables.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : RV</span>
<span class="sd">        other : RV, Param, value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : RV</span>
<span class="sd">             new RV which is the difference of self and other</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">RV</span><span class="p">):</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">RV</span><span class="p">(</span><span class="n">pf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">rvsub</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">pf</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">RV</span><span class="p">(</span><span class="n">pf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">loc</span><span class="p">((</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">other</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
    <span class="k">def</span> <span class="nf">_check_args_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span> <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;If an argument is passed to PF without a keyword, it must be a string.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pf</span> <span class="o">=</span> <span class="n">PF</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">_rvs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;One and only one RV should be found in </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">_rvs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rvtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">_rvs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rvtype</span> <span class="o">==</span> <span class="n">RV</span><span class="o">.</span><span class="n">CONTINUOUS</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;pdf_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;pmf_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_check_kwargs_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">foundArgs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">foundArgs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s">&#39;pf&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;You cannot declare a Random Variable without specifying a pf.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;self.name is already set to </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;pf&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pf</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;pf&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;rvtype&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rvtype</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;rvtype&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<span class="k">def</span> <span class="nf">check_method_exists</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">obj</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">StandardError</span><span class="p">(</span><span class="s">&#39;Object is not defined, check syntax.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="ow">or</span> 
        <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">name</span><span class="p">))):</span>
        <span class="k">raise</span> <span class="ne">StandardError</span><span class="p">(</span><span class="s">&#39;No </span><span class="si">%s</span><span class="s">() method found.&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="get_obj"><a class="viewcode-back" href="../../Reference.html#statspy.core.get_obj">[docs]</a><span class="k">def</span> <span class="nf">get_obj</span><span class="p">(</span><span class="n">obj_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a Param, PF or RV object.</span>

<span class="sd">    Look in the different dictionaries if an object named obj_name exists</span>
<span class="sd">    and returns it.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj_name : str</span>
<span class="sd">        Object name used to define a Param, PF or RV</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    new : Param, PF, RV</span>
<span class="sd">         Object if found in the dictionaries</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import statspy as sp</span>
<span class="sd">    &gt;&gt;&gt; mypmf = sp.PF(&#39;mypmf=poisson(n;lbda=5)&#39;)</span>
<span class="sd">    &gt;&gt;&gt; lbda = sp.get_obj(&#39;lbda&#39;)</span>
<span class="sd">    &gt;&gt;&gt; lbda.label = &#39;\\\\lambda&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">obj_dict</span> <span class="ow">in</span> <span class="p">(</span><span class="n">_drvs</span><span class="p">,</span> <span class="n">_dpfs</span><span class="p">,</span> <span class="n">_dparams</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj_name</span> <span class="ow">in</span> <span class="n">obj_dict</span><span class="p">:</span> <span class="k">continue</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> is found multiple times !&#39;</span> <span class="o">%</span> <span class="n">obj_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> has been found in </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">obj_name</span><span class="p">,</span> <span class="n">obj_dict</span><span class="p">))</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">obj_dict</span><span class="p">[</span><span class="n">obj_name</span><span class="p">][</span><span class="s">&#39;obj&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">obj</span>
</div>
<span class="k">def</span> <span class="nf">update_status</span><span class="p">(</span><span class="n">obj_dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check the list of objects depending on this parameter and update</span>
<span class="sd">    their isuptodate status to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">obj_key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;rvs&#39;</span><span class="p">,</span><span class="s">&#39;pfs&#39;</span><span class="p">,</span><span class="s">&#39;params&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj_key</span> <span class="ow">in</span> <span class="n">obj_dict</span><span class="p">:</span> <span class="k">continue</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">obj_dict</span><span class="p">[</span><span class="n">obj_key</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&quot;isuptodate&quot;</span><span class="p">):</span> <span class="n">obj</span><span class="o">.</span><span class="n">isuptodate</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj_key</span> <span class="o">==</span> <span class="s">&quot;rvs&quot;</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">_drvs</span><span class="p">:</span>
                    <span class="n">update_status</span><span class="p">(</span><span class="n">_drvs</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">obj_key</span> <span class="o">==</span> <span class="s">&quot;pfs&quot;</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">_dpfs</span><span class="p">:</span>
                    <span class="n">update_status</span><span class="p">(</span><span class="n">_dpfs</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">obj_key</span> <span class="o">==</span> <span class="s">&quot;params&quot;</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">_dparams</span><span class="p">:</span>
                    <span class="n">update_status</span><span class="p">(</span><span class="n">_dparams</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../index.html">StatsPy 0.1.0a1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, StatsPy Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>