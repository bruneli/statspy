<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>StatsPy Users Guide &mdash; StatsPy 0.1.0a1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="StatsPy 0.1.0a1 documentation" href="index.html" />
    <link rel="next" title="StatsPy Reference Guide" href="Reference.html" />
    <link rel="prev" title="Welcome to StatsPy’s documentation!" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Reference.html" title="StatsPy Reference Guide"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to StatsPy’s documentation!"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">StatsPy 0.1.0a1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="statspy-users-guide">
<h1><a class="toc-backref" href="#id2">StatsPy Users Guide</a><a class="headerlink" href="#statspy-users-guide" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#statspy-users-guide" id="id2">StatsPy Users Guide</a><ul>
<li><a class="reference internal" href="#introduction" id="id3">Introduction</a></li>
<li><a class="reference internal" href="#statspy-quick-start" id="id4">StatsPy Quick Start</a><ul>
<li><a class="reference internal" href="#conventions" id="id5">Conventions</a></li>
<li><a class="reference internal" href="#probability-functions" id="id6">Probability Functions</a><ul>
<li><a class="reference internal" href="#declaration-and-evaluation" id="id7">Declaration and evaluation</a></li>
<li><a class="reference internal" href="#operations-with-pfs" id="id8">Operations with PFs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#an-interlude-about-parameters" id="id9">An interlude about parameters</a></li>
<li><a class="reference internal" href="#perform-a-fit-to-data" id="id10">Perform a fit to data</a></li>
<li><a class="reference internal" href="#working-with-random-variables" id="id11">Working with Random Variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#statistical-inference-with-statspy" id="id12">Statistical inference with StatsPy</a><ul>
<li><a class="reference internal" href="#parameters-estimation" id="id13">Parameters estimation</a></li>
<li><a class="reference internal" href="#intervals-estimation" id="id14">Intervals estimation</a></li>
<li><a class="reference internal" href="#hypothesis-tests" id="id15">Hypothesis tests</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id3">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>StatsPy is a python based statistical package aimed to help users to build conveniently relatively complex probability functions which can be used later to fit to data, perform statistical tests or extract confidence intervals. StatsPy is originally inspired from the <a class="reference external" href="http://root.cern.ch/drupal/content/roofit">RooFit</a>/<a class="reference external" href="https://twiki.cern.ch/twiki/bin/view/RooStats">RooStats</a> packages used in High Energy Physics within the <a class="reference external" href="http://root.cern.ch/drupal/">CERN ROOT analysis framework</a>. The main two motivations for creating a new tool were to build a framework directly from python and thus oriented toward the &#8220;pythonic&#8221; scripting style, and to create a package built on top of the widely used <a class="reference external" href="http://docs.scipy.org/doc/">NumPy/SciPy</a> scientific stack.</p>
<p>The package development is yet at its beginning and currently focused on the main elements to build conveniently a probability function.</p>
</div>
<div class="section" id="statspy-quick-start">
<h2><a class="toc-backref" href="#id4">StatsPy Quick Start</a><a class="headerlink" href="#statspy-quick-start" title="Permalink to this headline">¶</a></h2>
<div class="section" id="conventions">
<h3><a class="toc-backref" href="#id5">Conventions</a><a class="headerlink" href="#conventions" title="Permalink to this headline">¶</a></h3>
<p>As many packages, StatsPy relies heavily on acronyms. The main ones are used to define the 3 basic classes used in StatsPy.</p>
<ul class="simple">
<li><strong>PF = Probability Function</strong>, a generic name, following Kendall&#8217;s Advanced Theory of Statistics, referring both to Probability Density Functions (PDF/pdf) in the case of continuous random variables and to Probability Mass Functions (PMF/pmf) for discrete random variables.</li>
<li><strong>RV = Random Variable</strong>, which is self explanatory.</li>
<li><strong>Param = Parameters</strong> denote quantities that appear specifically in the specification of the probability function. In the present package, any function of parameters will be also named a parameter, and such quantities are named DERIVED in opposition to RAW parameters.</li>
</ul>
</div>
<div class="section" id="probability-functions">
<h3><a class="toc-backref" href="#id6">Probability Functions</a><a class="headerlink" href="#probability-functions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="declaration-and-evaluation">
<h4><a class="toc-backref" href="#id7">Declaration and evaluation</a><a class="headerlink" href="#declaration-and-evaluation" title="Permalink to this headline">¶</a></h4>
<p>Probability functions are declared via the base class <tt class="docutils literal"><span class="pre">statspy.core.PF</span></tt></p>
<p><strong>Example 1</strong>, declare and call a normal distribution:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">statspy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mypdf</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">PF</span><span class="p">(</span><span class="s">&quot;pdf_norm=norm(x;mu=20,sigma=5)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case the whole PF is defined via the string argument</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">pdf_norm</span></tt>, the name of the PF is defined on the left-hand side of the assignment statement sign (&#8220;=&#8221;). Giving a name to a PF is optional but recommended. The name can be retrieved via:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mypdf</span><span class="o">.</span><span class="n">name</span>
<span class="go">pdf_norm</span>
</pre></div>
</div>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">norm</span></tt> is a keyword referring to the <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.norm.html#scipy.stats.norm">scipy.stats.norm</a> function which is used to compute the actual value of the PF. Any pdf or pmf defined in the <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/stats.html">scipy.stats</a> module can be used as a keyword. The statistical function should be followed by parenthesis.</p>
</li>
<li><p class="first">Within the parenthesis, the first part should be used to define the name of the random variable(s), <tt class="docutils literal"><span class="pre">x</span></tt>, in the case above.</p>
</li>
<li><p class="first">The second part of the parenthesis defines the list of shape parameters used to define a normal distribution, i.e. its mean and its rms. Their order should follow the one used by the <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.norm.html#scipy.stats.norm">scipy.stats.norm</a> function. The shape parameters are separated from the random variables via the &#8221;;&#8221; or &#8220;|&#8221; characters. If a shape parameter is new, it is automatically declared and registered within some internal dictionary. If a shape parameter has already been declared, the PF is linked toward it. It is possible to retrieve a Parameter via the function <tt class="docutils literal"><span class="pre">get_obj(name)</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mu</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">get_obj</span><span class="p">(</span><span class="s">&quot;mu&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mu</span><span class="o">.</span><span class="n">value</span>
<span class="go">20</span>
</pre></div>
</div>
</li>
</ul>
<p>Alternatively keyword arguments can be used to set various PF members:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">poisson_pmf</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">PF</span><span class="p">(</span><span class="s">&quot;poisson(n|lbda)&quot;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;pmf_poisson&quot;</span><span class="p">,</span><span class="n">lbda</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>To evaluate the probability function in <tt class="docutils literal"><span class="pre">x</span></tt>, the special method <tt class="docutils literal"><span class="pre">__call__</span></tt> is used. <tt class="docutils literal"><span class="pre">x</span></tt> can be either a float or an array:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mypdf</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
<span class="go">0.048394144903828672</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">400</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mypdf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s">&#39;r-&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Since available in scipy.stats, the cumulative distribution function (<tt class="docutils literal"><span class="pre">PF.cdf</span></tt>), the survival function (<tt class="docutils literal"><span class="pre">PF.sf</span></tt> = 1 - <tt class="docutils literal"><span class="pre">PF.cdf</span></tt>), and the logarithm of the probability function (<tt class="docutils literal"><span class="pre">PF.logpf</span></tt>) can be evaluated via:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mypdf</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mypdf</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">-</span><span class="n">mypdf</span><span class="o">.</span><span class="n">logpf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Finally, as in scipy.stats, it is possible to generate random variates using the function (<tt class="docutils literal"><span class="pre">PF.rvs</span></tt>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mypdf</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="operations-with-pfs">
<h4><a class="toc-backref" href="#id8">Operations with PFs</a><a class="headerlink" href="#operations-with-pfs" title="Permalink to this headline">¶</a></h4>
<p>The methods seen in the first section do not really bring value with respect to scipy.stats and are heavily relying on them. The real gain of StatsPy is the possibility to conveniently build new PFs from existing PFs via different operations:</p>
<ul>
<li><p class="first"><strong>addition</strong> of different PFs, for example if there is a random signal on top of a random background.</p>
<blockquote>
<div><p><strong>Example 2</strong>: a normally distributed signal on top of an exponentially falling background can be easily modelled with the following syntax:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">statspy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pdf_true_sig</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">PF</span><span class="p">(</span><span class="s">&quot;pdf_true_sig=norm(x;mu_true=125,sigma_true=10)&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pdf_true_bkg</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">PF</span><span class="p">(</span><span class="s">&quot;pdf_true_bkg=expon(x;offset_true=50,lambda_true=20)&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pdf_true</span> <span class="o">=</span> <span class="mf">0.95</span> <span class="o">*</span> <span class="n">pdf_true_bkg</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">pdf_true_sig</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">pdf_true</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">pdf_true_bkg</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">pdf_true_sig</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>When adding the two pdf <tt class="docutils literal"><span class="pre">pdf_true_sig</span></tt> and <tt class="docutils literal"><span class="pre">pdf_true</span></tt>, their normalization coefficients become nested.
If <em>c_sig</em> and <em>c_bkg</em> are the normalization coefficients of <tt class="docutils literal"><span class="pre">pdf_true_sig</span></tt> and <tt class="docutils literal"><span class="pre">pdf_true</span></tt> respectively, then <em>c_bkg</em> is redefined as a DERIVED parameter <em>c_bkg = 1 - c_sig</em>.
Similarly, if <em>n</em> PFs are added with <em>c_i</em> coefficients respectively, then <em>c_1</em> is defined as <em>1 - sum(i=2,i=n) c_i</em>.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>multiplication</strong> of PFs as when combining PFs applying to different random variables.</p>
<blockquote>
<div><p><strong>Example 3</strong>: product of two Poisson distributions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">statspy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pmf_on</span>  <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">PF</span><span class="p">(</span><span class="s">&#39;pmf_on=poisson(n_on;mu_on=1)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pmf_off</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">PF</span><span class="p">(</span><span class="s">&#39;pmf_off=poisson(n_off;mu_off=5)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">pmf_on</span> <span class="o">*</span> <span class="n">pmf_off</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">ticker</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">),</span> <span class="n">locator</span><span class="o">=</span><span class="n">ticker</span><span class="o">.</span><span class="n">LogLocator</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Other operations like convolutions will be presented in the section dedicated to <a class="reference internal" href="#working-with-random-variables">Working with Random Variables</a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="an-interlude-about-parameters">
<h3><a class="toc-backref" href="#id9">An interlude about parameters</a><a class="headerlink" href="#an-interlude-about-parameters" title="Permalink to this headline">¶</a></h3>
<p>Very often, in practical statistical inference problems, one wants to estimate
parameters which are not directly related to the parameters defining the pdf/pmf.
The <tt class="docutils literal"><span class="pre">core.Param</span></tt> class is designed such as it is relatively easy to define
DERIVED parameters from other parameters. The DERIVED parameters can then be
used to construct the different pdf/pmf.</p>
<p><strong>Example 3 (Con&#8217;t)</strong>: As an example, in the on/off problem, one is modelling
a counting device like a CCD camera behind a telescope. When the telescope is
pointing toward a source <tt class="docutils literal"><span class="pre">n_on</span></tt> events are counted, while <tt class="docutils literal"><span class="pre">n_off</span></tt> photons
are found with the telescope pointing at a source-free direction.
<tt class="docutils literal"><span class="pre">n_on</span></tt> is sensitive to the source signal rate <tt class="docutils literal"><span class="pre">s</span></tt> which one tries to
evaluate and to other sources leading to a background rate <tt class="docutils literal"><span class="pre">b</span></tt>. <tt class="docutils literal"><span class="pre">n_off</span></tt>
is a subsidiary measurement sensitive to <tt class="docutils literal"><span class="pre">b</span></tt> only. In practice, one will
model this problem with StatsPy via:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">statspy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mu</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="s">&quot;mu = 0.&quot;</span><span class="p">,</span> <span class="n">poi</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># Signal strength</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="s">&quot;s = 3.&quot;</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># Expected number of signal evts</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="s">&quot;b = 1.&quot;</span><span class="p">)</span> <span class="c"># Expected number of bkg evts in signal region</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tau</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="s">&quot;tau = 5.&quot;</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mu_on</span>  <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">b</span> <span class="c"># Total events expectation in the signal region</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mu_off</span> <span class="o">=</span> <span class="n">tau</span><span class="o">*</span><span class="n">b</span>      <span class="c"># Total events expectation in the control region</span>
</pre></div>
</div>
<p>Then the pmf and the likelihood can be defined like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pmf_on</span>  <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">PF</span><span class="p">(</span><span class="s">&#39;pmf_on=poisson(n_on;mu_on)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pmf_off</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">PF</span><span class="p">(</span><span class="s">&#39;pmf_off=poisson(n_off;mu_off)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">pmf_on</span> <span class="o">*</span> <span class="n">pmf_off</span>
</pre></div>
</div>
<p>In particular from the example above</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">mu_on</span></tt> and <tt class="docutils literal"><span class="pre">mu_off</span></tt> are what is called DERIVED parameters meaning they
are constructed from other parameters. When the value of <tt class="docutils literal"><span class="pre">mu</span></tt> or <tt class="docutils literal"><span class="pre">b</span></tt>
is changed, it gets automatically propagated to <tt class="docutils literal"><span class="pre">mu_on</span></tt> and <tt class="docutils literal"><span class="pre">mu_off</span></tt> and
the relevant pmf.</li>
<li>A parameter like <tt class="docutils literal"><span class="pre">s</span></tt> or <tt class="docutils literal"><span class="pre">tau</span></tt> can be defined as <tt class="docutils literal"><span class="pre">const=True</span></tt>. It means
that during fits, the parameter will be fixed to its value.</li>
<li>For hypothesis tests, it is necessary to distinguish between parameters of
interest (poi) and nuisance parameters. It is done by specifying <tt class="docutils literal"><span class="pre">poi=True</span></tt>
as for <tt class="docutils literal"><span class="pre">mu</span></tt> the signal strength in the on/off example.</li>
</ul>
</div>
<div class="section" id="perform-a-fit-to-data">
<h3><a class="toc-backref" href="#id10">Perform a fit to data</a><a class="headerlink" href="#perform-a-fit-to-data" title="Permalink to this headline">¶</a></h3>
<p>To perform a fit to data, two methods are provided in the <tt class="docutils literal"><span class="pre">PF</span></tt> class:
the least square method <tt class="docutils literal"><span class="pre">leastsq_fit</span></tt> and the maximum likelihood
method <tt class="docutils literal"><span class="pre">maxlikelihood_fit</span></tt>.</p>
<p><strong>Example 2 (Con&#8217;t)</strong>: considering again the example of a normally distributed
signal on top of an exponentially falling background, a least-square fit would
be done like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Define the background and signal PFs</span>
<span class="n">pdf_fit_bkg</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">PF</span><span class="p">(</span><span class="s">&quot;pdf_fit_bkg=expon(x;offset=50,lambda=10)&quot;</span><span class="p">)</span>
<span class="n">pdf_fit_sig</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">PF</span><span class="p">(</span><span class="s">&quot;pdf_fit_sig=norm(x;mu=120,sigma=20)&quot;</span><span class="p">)</span>
<span class="n">pdf_fit</span> <span class="o">=</span> <span class="n">pdf_fit_bkg</span> <span class="o">+</span> <span class="n">pdf_fit_sig</span>
<span class="n">pdf_fit_sig</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s">&#39;frac(sig)&#39;</span>
<span class="c"># Least square fit to the data (whole data range)</span>
</pre></div>
</div>
<div class="figure">
<img alt="_images/leastsq_fit.png" src="_images/leastsq_fit.png" />
<p class="caption">(<a class="reference download internal" href="_downloads/leastsq_fit.py"><tt class="xref download docutils literal"><span class="pre">Source</span> <span class="pre">code</span></tt></a>, <a class="reference download internal" href="_downloads/leastsq_fit.png"><tt class="xref download docutils literal"><span class="pre">png</span></tt></a>)</p>
</div>
</div>
<div class="section" id="working-with-random-variables">
<h3><a class="toc-backref" href="#id11">Working with Random Variables</a><a class="headerlink" href="#working-with-random-variables" title="Permalink to this headline">¶</a></h3>
<p>It is sometimes easier to think a problem in term of random variable than
in term of probability functions. We also might want to know the probability
function of a random variable given its formula as a function of other
random variables. The class <tt class="docutils literal"><span class="pre">statspy.core.RV</span></tt> is designed to solve some
of these problems (rescaling, additions, multplicitations) numerically.</p>
<p>Random variables are declared with a similar syntax to <tt class="docutils literal"><span class="pre">PF</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">statspy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">RV</span><span class="p">(</span><span class="s">&quot;norm(x|mu=10,sigma=2)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To access the <tt class="docutils literal"><span class="pre">PF</span></tt> associated to a Random Variable and its methods, the
<tt class="docutils literal"><span class="pre">self.pf</span></tt> class member should be used:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">pf</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="go">0.12098536225957168</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="go">0.84134474606854293</span>
</pre></div>
</div>
<p>and radom variates can be generated directly via the <tt class="docutils literal"><span class="pre">__call__</span></tt> special
method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>But the main usage of this class it to determine the PF of derived random
variables as illustrated by the code snippets and figure below.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">X</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">RV</span><span class="p">(</span><span class="s">&quot;norm(x;mux=15,sigmax=3)&quot;</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">RV</span><span class="p">(</span><span class="s">&quot;norm(y;muy=10,sigmay=4)&quot;</span><span class="p">)</span>
<span class="n">Z1</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">Y</span>
<span class="n">Z2</span> <span class="o">=</span> <span class="n">X</span> <span class="o">-</span> <span class="n">Y</span>
<span class="n">mux</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">get_obj</span><span class="p">(</span><span class="s">&#39;mux&#39;</span><span class="p">)</span>
<span class="n">sigmax</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">get_obj</span><span class="p">(</span><span class="s">&#39;sigmax&#39;</span><span class="p">)</span>
<span class="n">Z5</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">mux</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigmax</span>
</pre></div>
</div>
<div class="figure">
<img alt="_images/rv_operations.png" src="_images/rv_operations.png" />
<p class="caption">(<a class="reference download internal" href="_downloads/rv_operations.py"><tt class="xref download docutils literal"><span class="pre">Source</span> <span class="pre">code</span></tt></a>, <a class="reference download internal" href="_downloads/rv_operations.png"><tt class="xref download docutils literal"><span class="pre">png</span></tt></a>)</p>
</div>
</div>
</div>
<div class="section" id="statistical-inference-with-statspy">
<h2><a class="toc-backref" href="#id12">Statistical inference with StatsPy</a><a class="headerlink" href="#statistical-inference-with-statspy" title="Permalink to this headline">¶</a></h2>
<div class="section" id="parameters-estimation">
<h3><a class="toc-backref" href="#id13">Parameters estimation</a><a class="headerlink" href="#parameters-estimation" title="Permalink to this headline">¶</a></h3>
<p>The free parameters (i.e. parameters for which <tt class="docutils literal"><span class="pre">Param.const</span> <span class="pre">==</span> <span class="pre">False</span></tt>) of a
probability function can be fitted to data via two widely used methods.</p>
<ul>
<li><p class="first">The method of least squares which requires as minimial inputs the x- and y-
values of a set of data has already been illustrated in the
<a class="reference internal" href="#perform-a-fit-to-data">Perform a fit to data</a> section. After running a least square fit, the
free parameters of the fit have their <tt class="docutils literal"><span class="pre">value</span></tt> updated but also their
uncertainty <tt class="docutils literal"><span class="pre">unc</span></tt>. Uncertainties and correlations between free parameters
are computed using some approximation of the Hessian matrix.</p>
</li>
<li><p class="first">The maximum likelihood estimation only requires as input random variates:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">statspy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pdf_true</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">PF</span><span class="p">(</span><span class="s">&quot;pdf_true=norm(x|mu_true=20.,sigma_true=5.)&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">pdf_true</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pdf_fit</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">PF</span><span class="p">(</span><span class="s">&quot;pdf_fit=norm(x|mu_fit=1.,sigma_fit=1.)&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pdf_fit</span><span class="o">.</span><span class="n">maxlikelihood_fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">([mu_fit = 19.5111374418, sigma_fit = 5.12291410326], 41.053294585533187)</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="intervals-estimation">
<h3><a class="toc-backref" href="#id14">Intervals estimation</a><a class="headerlink" href="#intervals-estimation" title="Permalink to this headline">¶</a></h3>
<p>Interval estimation allows one to not only quote a point estimate of a
parameter but an interval of possible values. They are named confidence
intervals in a frequentist approach and credible intervals with a Bayesian
method. The aim of the module <tt class="docutils literal"><span class="pre">statspy.interval</span></tt> is provide functions to
conveniently compute both type of intervals.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">currently only the PLLR method (popular in HEP) is provided. Aim
is to add another method (Neyman construction) and a Bayesian
method</p>
</div>
<ul>
<li><p class="first">The <strong>profile (log-)likelihood ratio (PLLR)</strong> method is an approximate
frequentist approach relying on the profile likelihood ratio test statistics
and the Wilks&#8217; theorem to build confidence intervals.
Its main advantage with respect to other frequentist methods like the Neyman
construction is its speed and the possibility to apply it also in problems
with a large number of (nuisance) parameters.
To get an approximate confidence interval on a parameter
<span class="formula"><i>θ</i><sub><i>i</i></sub></span>
, the algorithm consists in:</p>
<ul>
<li><p class="first">Get the maximum likelihood estimate <span class="formula"><i>θ̂</i><sub><i>i</i></sub></span>
 as central value</p>
</li>
<li><dl class="first docutils">
<dt>Define a profile log-likehood ratio function <span class="formula"><i>q</i>(<i>θ</i><sub><i>i</i></sub>)</span>
 as</dt>
<dd><div class="first formula">
Λ(<i>θ</i><sub><i>i</i></sub>) = <span class="fraction"><span class="ignored">(</span><span class="numerator"><i>L</i>(<i>x</i>|<i>θ</i><sub><i>i</i></sub>, <i>θ̂̂</i><sub><i>s</i></sub>)</span><span class="ignored">)/(</span><span class="denominator"><i>L</i>(<i>x</i>|<i>θ̂</i><sub><i>i</i></sub>, <i>θ̂</i><sub><i>s</i></sub>)</span><span class="ignored">)</span></span>
</div>
<div class="last formula">
<i>q</i>(<i>θ</i><sub><i>i</i></sub>) =  − 2<i>log</i>(Λ(<i>θ</i><sub><i>i</i></sub>))
</div>
</dd>
</dl>
<p>where <span class="formula"><i>L</i>(<i>x</i>|<i>θ</i><sub><i>i</i></sub>, <i>θ̂̂</i><sub><i>s</i></sub>)</span>
 and
<span class="formula"><i>L</i>(<i>x</i>|<i>θ̂</i><sub><i>i</i></sub>, <i>θ̂</i><sub><i>s</i></sub>)</span>
 are the conditional and
unconditional maximum of the likelihood function respectively.</p>
</li>
<li><p class="first">Search for values of <span class="formula"><i>q</i>(<i>θ</i><sub><i>i</i></sub>)</span>
 equaling quantile defined as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">quantile</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="n">ndf</span><span class="p">)</span>
</pre></div>
</div>
<p>where cl is the confidence level and ndf the number of degrees of freedom.
This formula relies on the fact that the profile likelihood ratio is
asymptotically distributed by a chi2 function (Wilks&#8217; theorem). In
practical cases, it is therefore an approximation which can be verified
with a toy MC technique.</p>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="hypothesis-tests">
<h3><a class="toc-backref" href="#id15">Hypothesis tests</a><a class="headerlink" href="#hypothesis-tests" title="Permalink to this headline">¶</a></h3>
<p>As for interval estimation, the module <tt class="docutils literal"><span class="pre">statspy.hypotest</span></tt> provides methods
to perform hypothesis tests.</p>
<ul>
<li><p class="first">Quoting &#8220;Kendall&#8217;s Advanced Theory of Statistics&#8221;, the <strong>likelihood ratio
method</strong> has played a role in the theory of tests analogous to that of the
maximum likelihood method in the theory of estimation. Generally, one wish
to test the null hypothesis</p>
<div class="formula">
<i>H</i><sub>0</sub>:<i>θ</i><sub><i>r</i></sub> = <i>θ</i><sub><i>r</i>0</sub>
</div>
<p>against the alternative hypothesis</p>
<div class="formula">
<i>H</i><sub>1</sub>:<i>θ</i><sub><i>r</i></sub> ≠ <i>θ</i><sub><i>r</i>0</sub>
</div>
<p>taking into accound a number of nuisance parameters <span class="formula"><i>θ</i><sub><i>s</i></sub></span>
.
As for the likelihood ratio method used for interval estimation, one
defines the log-likehood ratio test statistics as</p>
<div class="formula">
Λ(<i>θ</i><sub><i>r</i>0</sub>) = <span class="fraction"><span class="ignored">(</span><span class="numerator"><i>L</i>(<i>x</i>|<i>θ</i><sub><i>r</i>0</sub>, <i>θ̂̂</i><sub><i>s</i></sub>)</span><span class="ignored">)/(</span><span class="denominator"><i>L</i>(<i>x</i>|<i>θ̂</i><sub><i>r</i></sub>, <i>θ̂</i><sub><i>s</i></sub>)</span><span class="ignored">)</span></span>
</div>
<div class="formula">
<i>q</i>(<i>θ</i><sub><i>r</i>0</sub>) =  − 2<i>log</i>(Λ(<i>θ</i><sub><i>r</i>0</sub>))
</div>
<p>with <span class="formula"><i>L</i>(<i>x</i>|<i>θ</i><sub><i>r</i>0</sub>, <i>θ̂̂</i><sub><i>s</i></sub>)</span>
 and
<span class="formula"><i>L</i>(<i>x</i>|<i>θ̂</i><sub><i>r</i></sub>, <i>θ̂</i><sub><i>s</i></sub>)</span>
 the conditional and
unconditional maximum of the likelihood function respectively.
Asymptotically <span class="formula"><i>q</i>(<i>θ</i><sub><i>r</i>0</sub>)</span>
 is distributed as a chi2 function
from which p-value or Z-value can be computed.
If the p-value is lower than a predefined type I error rate, then the
null hypothesis is rejected.</p>
<p><strong>Example 3 (Con&#8217;t)</strong>: considering again the on/off problem, to perform
a likelihood ratio test on the background only hypothesis (<tt class="docutils literal"><span class="pre">mu=0</span></tt>),
one would do:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="c"># n_on, n_off</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">statspy.hypotest</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">statspy</span><span class="o">.</span><span class="n">hypotest</span><span class="o">.</span><span class="n">pllr</span><span class="p">(</span><span class="n">likelihood</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;p-value&#39;</span><span class="p">,</span><span class="n">result</span><span class="o">.</span><span class="n">pvalue</span><span class="p">,</span><span class="s">&#39;Z-score&#39;</span><span class="p">,</span><span class="n">result</span><span class="o">.</span><span class="n">Zvalue</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">StatsPy Users Guide</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#statspy-quick-start">StatsPy Quick Start</a><ul>
<li><a class="reference internal" href="#conventions">Conventions</a></li>
<li><a class="reference internal" href="#probability-functions">Probability Functions</a><ul>
<li><a class="reference internal" href="#declaration-and-evaluation">Declaration and evaluation</a></li>
<li><a class="reference internal" href="#operations-with-pfs">Operations with PFs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#an-interlude-about-parameters">An interlude about parameters</a></li>
<li><a class="reference internal" href="#perform-a-fit-to-data">Perform a fit to data</a></li>
<li><a class="reference internal" href="#working-with-random-variables">Working with Random Variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#statistical-inference-with-statspy">Statistical inference with StatsPy</a><ul>
<li><a class="reference internal" href="#parameters-estimation">Parameters estimation</a></li>
<li><a class="reference internal" href="#intervals-estimation">Intervals estimation</a></li>
<li><a class="reference internal" href="#hypothesis-tests">Hypothesis tests</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to StatsPy&#8217;s documentation!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Reference.html"
                        title="next chapter">StatsPy Reference Guide</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/MANUAL.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Reference.html" title="StatsPy Reference Guide"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to StatsPy’s documentation!"
             >previous</a> |</li>
        <li><a href="index.html">StatsPy 0.1.0a1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, StatsPy Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>